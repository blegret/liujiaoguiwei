var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(n,r){function o(e){try{a(s.next(e))}catch(t){r(t)}}function h(e){try{a(s["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(o,h)}a((s=s.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,r,o,h,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return h={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},BaseSprite=function(e){function t(){var t=e.call(this)||this;return t.listenerArray=[],t.messageArray=[],t.addListener(t,egret.Event.REMOVED_FROM_STAGE,t.remove_view_handler,t),t.addListener(t,egret.Event.ADDED_TO_STAGE,t.add_view_handler,t),t}return __extends(t,e),t.prototype.add_view_handler=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.add_view_handler,this)},t.prototype.addListener=function(e,t,i,s,n){void 0===n&&(n=!1),this.listenerArray.push([e,t,i,s,n]),e.addEventListener(t,i,s,n)},t.prototype.removeListener=function(e,t,i,s,n){void 0===n&&(n=!1);for(var r=0;r<this.listenerArray.length;++r)this.listenerArray[r][0]==e&&this.listenerArray[r][1]==t&&this.listenerArray[r][2]==i&&this.listenerArray[r][3]==s&&this.listenerArray[r][4]==n&&(e.removeEventListener(t,i,this,n),this.listenerArray.splice(r,1),r--)},t.prototype.addMessage=function(e,t){this.messageArray.push([e,t]),Message.instance.add(e,t)},t.prototype.remove_view_handler=function(e){this.destroy()},t.prototype.destroy=function(){for(;this.numChildren>0;)this.removeChildAt(0);if(this.listenerArray)for(var e=0;e<this.listenerArray.length;e++)this.listenerArray[e][0].removeEventListener(this.listenerArray[e][1],this.listenerArray[e][2],this.listenerArray[e][3],this.listenerArray[e][4]);if(this.listenerArray=null,this.messageArray)for(var e=0;e<this.messageArray.length;++e)Message.instance.remove(this.messageArray[e][0],this.messageArray[e][1]);this.messageArray=null},t}(egret.Sprite);__reflect(BaseSprite.prototype,"BaseSprite");var BaseItemrenerer=function(e){function t(){var t=e.call(this)||this;return t.listenerArray=[],t.messageArray=[],t.addListener(t,egret.Event.REMOVED_FROM_STAGE,t.remove_view_handler,t),t.addListener(t,egret.Event.ADDED_TO_STAGE,t.add_view_handler,t),t}return __extends(t,e),t.prototype.add_view_handler=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.add_view_handler,this)},t.prototype.addListener=function(e,t,i,s,n){void 0===n&&(n=!1),this.listenerArray.push([e,t,i,s,n]),e.addEventListener(t,i,s,n)},t.prototype.removeListener=function(e,t,i,s,n){void 0===n&&(n=!1);for(var r=0;r<this.listenerArray.length;++r)this.listenerArray[r][0]==e&&this.listenerArray[r][1]==t&&this.listenerArray[r][2]==i&&this.listenerArray[r][3]==s&&this.listenerArray[r][4]==n&&(e.removeEventListener(t,i,this,n),this.listenerArray.splice(r,1),r--)},t.prototype.addMessage=function(e,t){this.messageArray.push([e,t]),Message.instance.add(e,t)},t.prototype.remove_view_handler=function(e){this.destroy()},t.prototype.destroy=function(){for(;this.numChildren>0;)this.removeChildAt(0);if(this.listenerArray)for(var e=0;e<this.listenerArray.length;e++)this.listenerArray[e][0].removeEventListener(this.listenerArray[e][1],this.listenerArray[e][2],this.listenerArray[e][3],this.listenerArray[e][4]);if(this.listenerArray=null,this.messageArray){for(var e=0;e<this.messageArray.length;++e)Message.instance.remove(this.messageArray[e][0],this.messageArray[e][1]);this.messageArray=null}},t}(eui.ItemRenderer);__reflect(BaseItemrenerer.prototype,"BaseItemrenerer");var BaseModule=function(e){function t(){var t=e.call(this)||this;return t.listenerArray=[],t.messageArray=[],t.addListener(t,egret.Event.REMOVED_FROM_STAGE,t.remove_view_handler,t),t.addListener(t,egret.Event.ADDED_TO_STAGE,t.add_view_handler,t),t}return __extends(t,e),t.prototype.add_view_handler=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.add_view_handler,this)},t.prototype.addListener=function(e,t,i,s,n){void 0===n&&(n=!1),this.listenerArray.push([e,t,i,s,n]),e.addEventListener(t,i,s,n)},t.prototype.removeListener=function(e,t,i,s,n){void 0===n&&(n=!1);for(var r=0;r<this.listenerArray.length;++r)this.listenerArray[r][0]==e&&this.listenerArray[r][1]==t&&this.listenerArray[r][2]==i&&this.listenerArray[r][3]==s&&this.listenerArray[r][4]==n&&(e.removeEventListener(t,i,this,n),this.listenerArray.splice(r,1),r--)},t.prototype.addMessage=function(e,t){this.messageArray.push([e,t]),Message.instance.add(e,t)},t.prototype.remove_view_handler=function(e){this.destroy()},t.prototype.destroy=function(){for(;this.numChildren>0;)this.removeChildAt(0);if(this.listenerArray)for(var e=0;e<this.listenerArray.length;e++)this.listenerArray[e][0].removeEventListener(this.listenerArray[e][1],this.listenerArray[e][2],this.listenerArray[e][3],this.listenerArray[e][4]);if(this.listenerArray=null,this.messageArray){for(var e=0;e<this.messageArray.length;++e)Message.instance.remove(this.messageArray[e][0],this.messageArray[e][1]);this.messageArray=null}},t}(eui.Component);__reflect(BaseModule.prototype,"BaseModule");var BaseConfig=function(){function e(){}return e.prototype.init=function(e,t,i){for(var s=RES.getRes(e),n=s.split("\n"),r=1;r<n.length;++r){var o=n[r].split("	");i.push(new t(o))}},e}();__reflect(BaseConfig.prototype,"BaseConfig");var Block=function(e){function t(){var t=e.call(this)||this;return t.block=null,t.blockShadow=null,t.triangle=null,t.direction=0,t.indexX=0,t.indexY=0,t.colourType=0,t.isInto=!1,t.isFrame=!1,t.offsetX=GameDateManager.instance.OffsetX,t.offsetY=GameDateManager.instance.OffsetY,t.scaleCoefficient=GameDateManager.instance.ScaleCoefficient,t.isRefreshPosition=!1,t}return __extends(t,e),t}(BaseSprite);__reflect(Block.prototype,"Block");var NPC=function(e){function t(){var t=e.call(this)||this;return t.npcIm=null,t.npcShadow=null,t.indexX=0,t.indexY=0,t.colourType=0,t.direction=-1,t.offsetX=GameDateManager.instance.OffsetX,t.offsetY=GameDateManager.instance.OffsetY,t}return __extends(t,e),t}(BaseSprite);__reflect(NPC.prototype,"NPC");var MainGame=function(e){function t(t){var i=e.call(this)||this;return i.circleMask=null,i.sceneSprite=null,i.zoomSprite=null,i.blockMg=null,i.npcMg=null,i.levelId=0,i.rMask=null,i.Millisecond=0,i.score=100,i.overNum=0,i.backBtnState=0,i.btnIsclick=!1,i.levelId=t,i.skinName="MainGameSceneSkin",i}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this.addListener(this,egret.Event.ENTER_FRAME,this.update,this),this.addListener(this.exml_againBtn,egret.TouchEvent.TOUCH_TAP,this.againHandler,this),this.addListener(this.exml_backMenuBtn,egret.TouchEvent.TOUCH_TAP,this.backMenuHandler,this),this.addListener(this.exml_soundBtn,egret.TouchEvent.TOUCH_TAP,this.soundHandler,this),this.addListener(this.exml_backBtn,egret.TouchEvent.TOUCH_TAP,this.backBlockHandler,this),this.addMessage(MsgCMD.PASS_THROUGH,this)},t.prototype.recvMsg=function(e,t){switch(e){case MsgCMD.PASS_THROUGH:this.passAnimation()}},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),t.game=this,GameDateManager.instance.getIsPlayMusic()?this.exml_soundBtn.iconDisplay.source="kai_png":this.exml_soundBtn.iconDisplay.source="guan_png",this.sceneSprite=new egret.Sprite,this.addChild(this.sceneSprite),this.sceneSprite.addChildAt(this.exml_gameGroup,20),this.zoomSprite=new egret.Sprite,this.sceneSprite.addChild(this.zoomSprite),this.npcMg=new NpcManager(this.levelId),this.zoomSprite.addChild(this.npcMg),this.blockMg=new BlockManager(this.levelId),this.zoomSprite.addChild(this.blockMg),1==this.levelId&&"0"==egret.localStorage.getItem("level1")&&(this.rMask=new ReverseMask,this.sceneSprite.addChild(this.rMask),this.rMask.createGuide(0)),2==this.levelId&&"true"==egret.localStorage.getItem("level2IsFirstRun")&&(this.rMask=new ReverseMask,this.sceneSprite.addChild(this.rMask),this.rMask.createGuide(3)),6==this.levelId&&"true"==egret.localStorage.getItem("level6IsFirstRun")&&(this.rMask=new ReverseMask,this.sceneSprite.addChild(this.rMask),this.rMask.createGuide(4)),this.zoomSprite.width=this.stage.stageWidth,this.zoomSprite.height=this.stage.stageHeight,this.zoomSprite.anchorOffsetX=this.zoomSprite.width/2,this.zoomSprite.anchorOffsetY=this.zoomSprite.height/2,this.zoomSprite.x=this.stage.stageWidth/2,this.zoomSprite.y=this.stage.stageHeight/2,this.exml_playerScoreLab.text=this.exml_scoreShadowLab.text=egret.localStorage.getItem("playerScore"),this.circleMaskHandler(),egret.Tween.get(this.circleMask,{loop:!1}).to({scaleX:0,scaleY:0}).to({scaleX:11,scaleY:11},500),this.exml_backShadowImg.visible=!0,this.exml_backBtn.touchEnabled=!1,this.changeSceneSize()},t.prototype.circleMaskHandler=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight;this.circleMask=new egret.Shape,this.circleMask.anchorOffsetX=this.circleMask.width/2,this.circleMask.anchorOffsetY=this.circleMask.height/2,this.circleMask.x=e/2,this.circleMask.y=t/2,this.circleMask.graphics.beginFill(65535),this.circleMask.graphics.drawCircle(0,0,50),this.circleMask.graphics.endFill(),this.addChild(this.circleMask),this.sceneSprite.mask=this.circleMask},t.prototype.update=function(){if((!this.rMask||this.rMask&&this.rMask.getState()>10&&1==this.levelId||this.rMask&&this.rMask.getState()>10&&2==this.levelId||this.rMask&&this.rMask.getState()>10&&6==this.levelId)&&this.isGameOver()&&0==this.overNum&&(this.overNum=1,this.passAnimation()),!this.isGameOver())if((!this.rMask||this.rMask&&this.rMask.getState()>10&&1==this.levelId||this.rMask&&this.rMask.getState()>10&&2==this.levelId||this.rMask&&this.rMask.getState()>10&&6==this.levelId)&&this.Millisecond++,this.score>=1&&this.Millisecond>=60&&(this.score--,this.exml_countDownLab.text=this.score.toString(),this.exml_countShadowLab.text=this.score.toString(),this.Millisecond=0),this.zoomSprite.x=this.stage.stageWidth/2,this.zoomSprite.y=this.stage.stageHeight/2,this.zoomSprite.scaleX<=.25)switch(this.backBtnState){case 0:this.exml_backBtn.alpha-=.03,this.exml_backBtn.alpha<=0&&(this.backBtnState=1);break;case 1:this.exml_backBtn.alpha+=.03,this.exml_backBtn.alpha>=1&&(this.backBtnState=0)}else this.exml_backBtn.alpha=1;BackBlock.instance.backBlockArr.length<=0&&BackBlock.instance.backIndexArr.length<=0&&BackBlock.instance.backBlockDirectionArr.length<=0&&BackBlock.instance.blockEnterQueneNumArr.length<=0?(this.exml_backShadowImg.visible=!0,this.exml_backBtn.touchEnabled=!1):(this.exml_backShadowImg.visible=!1,this.exml_backBtn.touchEnabled=!0)},t.prototype.passAnimation=function(){var e=this;GameDateManager.instance.getIsPlayMusic()&&SoundManager.getInstance().playEffect("soundLvlCompleted_mp3"),1==this.levelId&&"0"==egret.localStorage.getItem("level1")&&egret.localStorage.setItem("level1","1"),2==this.levelId&&"true"==egret.localStorage.getItem("level2IsFirstRun")&&egret.localStorage.setItem("level2IsFirstRun","false"),6==this.levelId&&"true"==egret.localStorage.getItem("level6IsFirstRun")&&egret.localStorage.setItem("level6IsFirstRun","false"),egret.Tween.get(this.circleMask,{loop:!1}).to({scaleX:0,scaleY:0},500).wait(150).call(function(){egret.Tween.removeTweens(e),BackBlock.instance.resetQuene(),Message.instance.send(MsgCMD.SHOW_GAME_OVER,{levelId:e.levelId,score:e.score})})},t.prototype.isGameOver=function(){for(var e=this.blockMg.BlockArr,t=0;t<e.length;t++)if(!e[t].isInto)return!1;return egret.log("游戏结束"),!0},Object.defineProperty(t.prototype,"BlockMg",{get:function(){return this.blockMg},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"NpcMg",{get:function(){return this.npcMg},enumerable:!0,configurable:!0}),t.prototype.getLevelId=function(){return this.levelId},t.prototype.changeSceneSize=function(){var e=null,t=null;e=new Array,t=new Array;for(var i=0,s=0,n=0,r=0,o=.8,h=.8,a=.8,c=.8,l=1,d=1,g=0;g<this.blockMg.BlockArr.length;g++)e.push(this.blockMg.BlockArr[g].indexX),t.push(this.blockMg.BlockArr[g].indexY);if(this.sort(e),this.sort(t),n=e[0],r=t[0],i=e[e.length-1],s=t[t.length-1],s>4||2>r){if(s>4)for(var p=s-4,g=0;p-1>g;g++)h=.8*h;if(2>r)for(var p=Math.abs(r-2),g=0;p-1>g;g++)c=.8*c;d=h>c?c:h}if(i>8||2>n){if(i>8)for(var p=i-8,g=0;p-1>g;g++)o=.8*o;if(2>n)for(var p=Math.abs(n-2),g=0;p-1>g;g++)a=.8*a;l=o>a?a:o}l>d?(this.zoomSprite.scaleX=this.zoomSprite.scaleY=d,egret.log("_indexYScale=",d)):(this.zoomSprite.scaleX=this.zoomSprite.scaleY=l,egret.log("_indexXScale=",l))},t.prototype.sort=function(e){for(var t=0,i=0;i<e.length-1;i++)for(var s=0;s<e.length-i-1;s++)e[s]>e[s+1]&&(e[s]=e[s]+e[s+1],e[s+1]=e[s]-e[s+1],e[s]=e[s]-e[s+1]),t++},t.prototype.againHandler=function(){var e=this;this.btnIsclick||(this.btnIsclick=!this.btnIsclick,GameDateManager.instance.getIsPlayMusic()&&SoundManager.getInstance().playEffect("soundClick_mp3"),egret.Tween.get(this.exml_againBtn,{loop:!1}).to({scaleX:.7,scaleY:.7},200,egret.Ease.backOut).call(function(){egret.Tween.get(e.circleMask,{loop:!1}).to({scaleX:0,scaleY:0},500).wait(200).call(function(){egret.Tween.removeTweens(e),BackBlock.instance.resetQuene(),Message.instance.send(MsgCMD.SHOW_MAIN_GAME,e.levelId)})}))},t.prototype.backMenuHandler=function(){var e=this;this.btnIsclick||(this.btnIsclick=!this.btnIsclick,GameDateManager.instance.getIsPlayMusic()&&SoundManager.getInstance().playEffect("soundClick_mp3"),egret.Tween.get(this.exml_backMenuBtn,{loop:!1}).to({scaleX:.7,scaleY:.7},200,egret.Ease.backOut).call(function(){egret.Tween.get(e.circleMask,{loop:!1}).to({scaleX:0,scaleY:0},500).wait(150).call(function(){egret.Tween.removeTweens(e),BackBlock.instance.resetQuene(),Message.instance.send(MsgCMD.SHOW_MAIN_MENU)})}))},t.prototype.soundHandler=function(){egret.Tween.get(this.exml_soundBtn,{loop:!1}).to({scaleX:.9,scaleY:.9},50,egret.Ease.backOut).to({scaleX:1,scaleY:1},50,egret.Ease.backOut);var e=GameDateManager.instance.getIsPlayMusic();GameDateManager.instance.setIsPlayMusic(!e),0==!e&&(this.exml_soundBtn.iconDisplay.source="guan_png"),1==!e&&(this.exml_soundBtn.iconDisplay.source="kai_png"),e||SoundManager.getInstance().playEffect("soundClick_mp3")},t.prototype.backBlockHandler=function(){GameDateManager.instance.getIsPlayMusic()&&PlaySound.instance.randomPlaySound(),BackBlock.instance.backBlockArr.length>0&&egret.Tween.get(this.exml_backBtn,{loop:!1}).to({scaleX:.7,scaleY:.7},150,egret.Ease.backOut).to({scaleX:1,scaleY:1},150,egret.Ease.backOut).call(function(){BackBlock.instance.blockBack()})},t.game=null,t}(BaseModule);__reflect(MainGame.prototype,"MainGame",["IMessage"]);var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var Global=function(){function e(){}return e}();__reflect(Global.prototype,"Global");var HashMap=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.put=function(e,t){this[e]=t},t.prototype.get=function(e){return this[e]},t.prototype.remove=function(e){var t=this[e];return t&&delete this[e],t},t.prototype.contains=function(e){return null!=this[e]},t.prototype.keys=function(){var e=Object.keys(this),t=e.indexOf("_hashCode");t>-1&&e.splice(t,1);var t=e.indexOf("$hashCode");return t>-1&&e.splice(t,1),e},t.prototype.clear=function(){for(var e=this.keys(),t=e.length,i=0;t>i;i++)this.remove(e[i])},t.prototype.toArray=function(){for(var e=[],t=this.keys(),i=t.length,s=0;i>s;++s)e.push(this.get(t[s]));return e},t}(egret.HashObject);__reflect(HashMap.prototype,"HashMap");var Message=function(){function e(){this.msgMap=new HashMap}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var i=this.msgMap.get(e);i||(i=[],this.msgMap.put(e,i)),-1==i.indexOf(t)&&i.push(t)},e.prototype.remove=function(e,t){var i=this.msgMap.get(e);if(i)for(var s=i.length,n=0;s>n;n++)i[n]==t&&(i[n]=null)},e.prototype.send=function(e,t){void 0===t&&(t=null);var i=this.msgMap.get(e);if(i){for(var s=i.length,n=0;s>n;)i[n]?(i[n].recvMsg.call(i[n],e,t),n++):(i.splice(n,1),s--);0>=s&&this.msgMap.remove(e)}},e}();__reflect(Message.prototype,"Message");var MsgCMD=function(){function e(){}return e.SHOW_MAIN_MENU=1e7,e.SHOW_MAIN_GAME=10000001,e.SHOW_GAME_PAUSE=10000002,e.ADD_PLAYER_BULLET=10000003,e.REMOVE_PLAYER_BULLET=10000004,e.REMOVE_NPC=10000005,e.ADD_NPC_BULLET=10000006,e.REMOVE_NPC_BULLET=10000007,e.REMOVE_EFFECT_1=10000008,e.REMOVE_EFFECT_2=10000009,e.ADD_PROP=10000010,e.REMOVE_PROP=10000011,e.SUB_NPC_HP=10000012,e.PASS_PLAYER_COORDINATE=10000100,e.SHOW_LEVEL_SCENE=10000019,e.SHOW_LEVEL_ID=10000020,e.CURRENT_GAME_CARD=10000021,e.GAME_VICTORY=10000022,e.GAME_FAILURE=10000023,e.SHOW_LEVEL_ID_TO_LEVEL=10000033,e.SHOW_GAME_OVER=10000034,e.CHANGE_POSITION_YELLOW=10000035,e.CHANGE_POSITION_BLUE=10000036,e.CHANGE_POSITION_RED=10000037,e.CHANGE_POSITION_PINK=10000038,e.CHANGE_POSITION_GREEN=10000039,e.CHANGE_REVERNASK_STATE=10000040,e.CHANGE_REVERNASK_STATE_YELLOW=10000041,e.PASS_THROUGH=10000042,e}();__reflect(MsgCMD.prototype,"MsgCMD");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,s){function n(e){t.call(s,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(s))}var o=this;"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(s,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(e,i){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(s,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var LevelConfig=function(e){function t(){var t=e.call(this)||this;return t.dataList1=[],t.dataList2=[],t.dataList3=[],t.dataList4=[],t.dataList5=[],t}return __extends(t,e),t.getInstnace=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.init=function(t,i,s,n){var r=-1;switch(r=n){case 0:e.prototype.init.call(this,"levelConfig_txt",LevelConfigModel,this.dataList1);break;case 1:e.prototype.init.call(this,"levelConfig1_txt",LevelConfigModel,this.dataList2);break;case 2:e.prototype.init.call(this,"levelConfig2_txt",LevelConfigModel,this.dataList3);break;case 3:e.prototype.init.call(this,"levelConfig3_txt",LevelConfigModel,this.dataList4);break;case 4:e.prototype.init.call(this,"levelConfig4_txt",LevelConfigModel,this.dataList5)}},t.prototype.getLevel1Arr=function(){return this.dataList1},t.prototype.getLevel2Arr=function(){return this.dataList2},t.prototype.getLevel3Arr=function(){return this.dataList3},t.prototype.getLevel4Arr=function(){return this.dataList4},t.prototype.getLevel5Arr=function(){return this.dataList5},t.prototype.getLevel1ById=function(e){for(var t=0;t<this.dataList1.length;++t)if(this.dataList1[t].id==e)return this.dataList1[t];return null},t.prototype.getLevel2ById=function(e){for(var t=0;t<this.dataList2.length;++t)if(this.dataList2[t].id==e)return this.dataList2[t];return null},t.prototype.getLevel3ById=function(e){for(var t=0;t<this.dataList3.length;++t)if(this.dataList3[t].id==e)return this.dataList3[t];return null},t.prototype.getLevel4ById=function(e){for(var t=0;t<this.dataList4.length;++t)if(this.dataList4[t].id==e)return this.dataList4[t];return null},t.prototype.getLevel5ById=function(e){for(var t=0;t<this.dataList5.length;++t)if(this.dataList5[t].id==e)return this.dataList5[t];return null},t}(BaseConfig);__reflect(LevelConfig.prototype,"LevelConfig");var LevelConfigModel=function(){function e(e){this.id=parseInt(e[0]),this.name=e[1],this.lv=parseInt(e[2])}return e}();__reflect(LevelConfigModel.prototype,"LevelConfigModel");var GameDateManager=function(){function e(){this.isFirstRun=!0,this.isPause=!1,this.score=0,this.scoreBast=0,this.isUpdateBast=!1,this.isPlayMusic=!0,this.rankLisk=[],this.offsetX=137.84,this.offsetY=38.222,this.mapData=null,this.scaleCoefficient=.8;for(var e=0;10>e;e++)this.rankLisk[e]=0;this.mapData=new Array;for(var e=0;10>e;e++){var t=new Array;this.mapData.push(t);for(var i=0;5>i;i++)this.mapData[e].push(-2)}}return Object.defineProperty(e,"instance",{get:function(){return null==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.getIsFirstRun=function(){return this.isFirstRun},e.prototype.setIsFirstRun=function(e){this.isFirstRun=e},e.prototype.getIsPause=function(){return this.isPause},e.prototype.setIsPause=function(e){this.isPause=e},e.prototype.getScore=function(){return this.score},e.prototype.setScore=function(e){this.score=e},e.prototype.getScoreBast=function(){return this.scoreBast},e.prototype.setScoreBast=function(e){this.scoreBast=e},e.prototype.getIsUpdateBast=function(){return this.isUpdateBast},e.prototype.setIsUpdateBast=function(e){this.isUpdateBast=e},e.prototype.getIsPlayMusic=function(){return this.isPlayMusic},e.prototype.setIsPlayMusic=function(e){this.isPlayMusic=e},e.prototype.getRankList=function(){return this.rankLisk},e.prototype.setRankList=function(e){this.rankLisk=e},Object.defineProperty(e.prototype,"OffsetX",{get:function(){return this.offsetX},set:function(e){this.offsetX=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"OffsetY",{get:function(){return this.offsetY},set:function(e){this.offsetY=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"MapData",{get:function(){return this.mapData},set:function(e){this.mapData=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ScaleCoefficient",{get:function(){return this.scaleCoefficient},set:function(e){this.scaleCoefficient=e},enumerable:!0,configurable:!0}),e}();__reflect(GameDateManager.prototype,"GameDateManager");var SoundManager=function(){function e(){this._musicPosition=0}return e.getInstance=function(){return null==this._instance&&(this._instance=new e),this._instance},e.prototype.startBgMusic=function(e){this.stopBgMusic(),this.bgSound=RES.getRes(e),this.bgSound.type=egret.Sound.MUSIC,this.bgSoundChannel=this.bgSound.play(0,0)},e.prototype.loadBgMusicHandler=function(e,t){this.stopBgMusic(),this.bgSound=e,this.bgSound.type=egret.Sound.MUSIC,this.bgSoundChannel=this.bgSound.play(0,0),this.bgSoundChannel.addEventListener(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this)},e.prototype.pauseBgMusic=function(){null!=this.bgSound&&(this._musicPosition=this.bgSoundChannel.position,this.bgSoundChannel.stop())},e.prototype.continueBgMusic=function(e){return null==this.bgSound?(this.stopBgMusic(),void(e&&(this.bgSound=RES.getRes(e),this.bgSound.type=egret.Sound.MUSIC,this.bgSoundChannel=this.bgSound.play(0,0)))):void(this.bgSoundChannel=this.bgSound.play(this._musicPosition,0))},e.prototype.stopBgMusic=function(){this.bgSound&&(this.bgSound=null),this.bgSoundChannel&&(this.bgSoundChannel.stop(),this.bgSoundChannel.removeEventListener(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this),this.bgSoundChannel=null)},e.prototype.onSoundComplete=function(e){console.log("bgSoundComplete")},e.prototype.playEffect=function(e){RES.getResAsync(e,this.loadEffectHandler,this)},e.prototype.loadEffectHandler=function(e,t){e.type=egret.Sound.EFFECT,e.play(0,1)},e}();__reflect(SoundManager.prototype,"SoundManager");var GameOver=function(e){function t(t){var i=e.call(this)||this;return i.circleMask=null,i.levelId=0,i.score=0,i.btnIsClick=!1,i.levelId=t.levelId,i.score=t.score,i.skinName="GameOverSceneSkin",i}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this.addListener(this.exml_againBtn,egret.TouchEvent.TOUCH_TAP,this.againHandler,this),this.addListener(this.exml_backMenuBtn,egret.TouchEvent.TOUCH_TAP,this.backMenuHandler,this),this.addListener(this.exml_nextBtn,egret.TouchEvent.TOUCH_TAP,this.nextHandler,this),this.addListener(this.exml_soundBtn,egret.TouchEvent.TOUCH_TAP,this.soundHandler,this)},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),GameDateManager.instance.getIsPlayMusic()?this.exml_soundBtn.iconDisplay.source="kai_png":this.exml_soundBtn.iconDisplay.source="guan_png",this.levelId>=6&&egret.localStorage.setItem("isFirstRun","1");var t=egret.localStorage.getItem("level"+this.levelId.toString()+"score");if(Number(t)<this.score){egret.localStorage.setItem("level"+this.levelId.toString()+"score",this.score.toString());for(var i=0,s=1;20>s;s++)i+=Number(egret.localStorage.getItem("level"+s.toString()+"score"));egret.localStorage.setItem("playerScore",i.toString())}if(this.exml_completeShadow.text=this.exml_completeLab.text="Level  "+this.levelId+"  Complete",this.exml_scoreShadowLab.text=this.exml_scoreLab.text=this.score.toString(),this.exml_playerScoreShadow.text=this.exml_playerScore.text=egret.localStorage.getItem("playerScore"),this.circleMaskHandler(),"true"==egret.localStorage.getItem("level2IsFirstRun")){var n=new ReverseMask;this.exml_overGroup.addChild(n),n.createGuide(2)}var r=(egret.Tween.get(this.circleMask,{loop:!1}).to({scaleX:0,scaleY:0}).wait(100).to({scaleX:55,scaleY:55},500),this.levelId+1);egret.localStorage.setItem("level"+r.toString(),"1")},t.prototype.circleMaskHandler=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight;this.circleMask=new egret.Shape,this.circleMask.anchorOffsetX=this.circleMask.width/2,this.circleMask.anchorOffsetY=this.circleMask.height/2,this.circleMask.x=e/2,this.circleMask.y=t/2,this.circleMask.graphics.beginFill(65535),this.circleMask.graphics.drawCircle(0,0,10),this.circleMask.graphics.endFill(),this.addChild(this.circleMask),this.exml_overGroup.mask=this.circleMask},t.prototype.againHandler=function(){var e=this;if(!this.btnIsClick){this.btnIsClick=!this.btnIsClick,GameDateManager.instance.getIsPlayMusic()&&SoundManager.getInstance().playEffect("soundClick_mp3");egret.Tween.get(this.exml_againBtn,{loop:!1}).to({scaleX:.7,scaleY:.7},150,egret.Ease.backOut).call(function(){egret.Tween.get(e.circleMask,{loop:!1}).to({scaleX:0,scaleY:0},500).wait(200).call(function(){egret.Tween.removeTweens(e),Message.instance.send(MsgCMD.SHOW_MAIN_GAME,e.levelId)})})}},t.prototype.backMenuHandler=function(){var e=this;if(!this.btnIsClick){this.btnIsClick=!this.btnIsClick,GameDateManager.instance.getIsPlayMusic()&&SoundManager.getInstance().playEffect("soundClick_mp3");egret.Tween.get(this.exml_backMenuBtn,{loop:!1}).to({scaleX:.7,scaleY:.7},150,egret.Ease.backOut).call(function(){egret.Tween.get(e.circleMask,{loop:!1}).to({scaleX:0,scaleY:0},500).wait(150).call(function(){egret.Tween.removeTweens(e),Message.instance.send(MsgCMD.SHOW_MAIN_MENU)})})}},t.prototype.nextHandler=function(){var e=this;if(!this.btnIsClick){this.btnIsClick=!this.btnIsClick,GameDateManager.instance.getIsPlayMusic()&&SoundManager.getInstance().playEffect("soundClick_mp3");egret.Tween.get(this.exml_nextBtn,{loop:!1}).to({scaleX:.7,scaleY:.7},150,egret.Ease.backOut).call(function(){egret.Tween.get(e.circleMask,{loop:!1}).to({scaleX:0,scaleY:0},500).wait(200).call(function(){egret.Tween.removeTweens(e),Message.instance.send(MsgCMD.SHOW_MAIN_GAME,e.levelId+1)})})}},t.prototype.soundHandler=function(){egret.Tween.get(this.exml_soundBtn,{loop:!1}).to({scaleX:.9,scaleY:.9},50,egret.Ease.backOut).to({scaleX:1,scaleY:1},50,egret.Ease.backOut);var e=GameDateManager.instance.getIsPlayMusic();GameDateManager.instance.setIsPlayMusic(!e),0==!e&&(this.exml_soundBtn.iconDisplay.source="guan_png"),1==!e&&(this.exml_soundBtn.iconDisplay.source="kai_png"),e||SoundManager.getInstance().playEffect("soundClick_mp3")},t}(BaseModule);__reflect(GameOver.prototype,"GameOver");var MainModule=function(e){function t(){var t=e.call(this)||this;return t.viewSp=new egret.Sprite,t.addChild(t.viewSp),t.firstSp=new egret.Sprite,t.addChild(t.firstSp),t.viewSp.addChild(new MainMenu),t.firstSp.addChild(PanelController.instance),t.addMessage(MsgCMD.SHOW_MAIN_GAME,t),t.addMessage(MsgCMD.SHOW_MAIN_MENU,t),t.addMessage(MsgCMD.SHOW_GAME_OVER,t),t.addMessage(MsgCMD.SHOW_LEVEL_SCENE,t),t}return __extends(t,e),t.prototype.recvMsg=function(e,t){switch(e){case MsgCMD.SHOW_MAIN_MENU:this.removeAll(),this.viewSp.addChild(new MainMenu);break;case MsgCMD.SHOW_LEVEL_SCENE:this.removeAll(),this.viewSp.addChild(new LevelsScene);break;case MsgCMD.SHOW_MAIN_GAME:this.removeAll(),this.viewSp.addChild(new MainGame(t));break;case MsgCMD.SHOW_GAME_OVER:this.removeAll(),this.viewSp.addChild(new GameOver(t))}},t.prototype.removeAll=function(){for(var e=this.viewSp.numChildren,t=0;e>t;++t)this.viewSp.removeChildAt(t)},t}(BaseSprite);__reflect(MainModule.prototype,"MainModule",["IMessage"]);var PanelController=function(e){function t(){var t=e.call(this)||this;return t.panelArr=[],t.addListener(t,egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.onAddToStage=function(e){},t.prototype.add=function(e){-1==this.panelArr.indexOf(e)&&(this.addChild(e),this.panelArr.push(e))},t.prototype.remove=function(e){var t=this.panelArr.indexOf(e);-1!=t&&(this.panelArr.splice(t,1),this.removeChild(e),e=null)},t.prototype.removeAll=function(){for(var e=0;e<this.panelArr.length;++e)this.removeChild(this.panelArr[e]),this.panelArr[e]=null;this.panelArr=[]},t.prototype.hide=function(e){for(var t=0;t<this.panelArr.length;++t)this.panelArr[t]instanceof e&&(this.panelArr[t].visible=!1)},t.prototype.show=function(e){for(var t=0;t<this.panelArr.length;++t)this.panelArr[t]instanceof e&&(this.panelArr[t].visible=!0)},t}(BaseSprite);__reflect(PanelController.prototype,"PanelController");var BackBlock=function(){function e(){this.backBlockArr=null,this.backIndexArr=null,this.backBlockDirectionArr=null,this.blockEnterQueneNumArr=null,this.backBlockArr=new Array,this.backIndexArr=new Array,this.backBlockDirectionArr=new Array,this.blockEnterQueneNumArr=new Array}return Object.defineProperty(e,"instance",{get:function(){return null==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.clickBlockEnterQueue=function(e,t,i,s){this.backBlockArr.push(e),this.backIndexArr.push(t,i),this.backBlockDirectionArr.push(s)},e.prototype.blockBack=function(){for(var e=this.blockEnterQueneNumArr.length,t=0;t<this.blockEnterQueneNumArr[e-1];t++){var i=this.backBlockArr.length,s=this.backIndexArr.length,n=this.backBlockDirectionArr.length;
this.backBlockArr[i-1].changePosition(this.backIndexArr[s-2],this.backIndexArr[s-1],this.backBlockDirectionArr[n-1]),this.cleanQuene()}this.cleanQueneNumArrQuene(this.blockEnterQueneNumArr[e-1])},e.prototype.cleanQuene=function(){var e=this.backBlockArr.length;this.cleanBlockQuene(this.backBlockArr[e-1]);for(var t=0;2>t;t++){var i=this.backIndexArr.length;this.cleanIndexQuene(this.backIndexArr[i-1])}var s=this.backBlockDirectionArr.length;this.cleanBlockDirectionQuene(this.backBlockDirectionArr[s-1])},e.prototype.cleanBlockQuene=function(e){var t=this.backBlockArr.lastIndexOf(e);-1!=t&&(this.backBlockArr[t]=null,this.backBlockArr.splice(t,1))},e.prototype.cleanIndexQuene=function(e){var t=this.backIndexArr.lastIndexOf(e);-1!=t&&(this.backIndexArr[t]=null,this.backIndexArr.splice(t,1))},e.prototype.cleanBlockDirectionQuene=function(e){var t=this.backBlockDirectionArr.lastIndexOf(e);-1!=t&&(this.backBlockDirectionArr[t]=null,this.backBlockDirectionArr.splice(t,1))},e.prototype.cleanQueneNumArrQuene=function(e){var t=this.blockEnterQueneNumArr.lastIndexOf(e);-1!=t&&(this.blockEnterQueneNumArr[t]=null,this.blockEnterQueneNumArr.splice(t,1))},e.prototype.resetQuene=function(){this.backBlockArr.splice(0,this.backBlockArr.length),this.backIndexArr.splice(0,this.backIndexArr.length),this.backBlockDirectionArr.splice(0,this.backBlockDirectionArr.length),this.blockEnterQueneNumArr.splice(0,this.blockEnterQueneNumArr.length)},e}();__reflect(BackBlock.prototype,"BackBlock");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.backGround=new egret.ImageLoader,t.land=new egret.ImageLoader,t.grassLand=new egret.ImageLoader,t.grassLandMask=new egret.ImageLoader,t.grass=new egret.ImageLoader,t.load=!1,t.i=0,t.once(egret.Event.ADDED_TO_STAGE,t.createView,t),t}return __extends(t,e),t.prototype.createView=function(){this.backGround.once(egret.Event.COMPLETE,this.imageHandler,this),this.land.once(egret.Event.COMPLETE,this.imageHandler,this),this.grassLand.once(egret.Event.COMPLETE,this.imageHandler,this),this.grassLandMask.once(egret.Event.COMPLETE,this.imageHandler,this),this.grass.once(egret.Event.COMPLETE,this.imageHandler,this),this.backGround.load("resource/assets/loadViewWidth/loadBg.jpg")},t.prototype.imageHandler=function(e){var t=e.currentTarget,i=t.data,s=new egret.Texture;s._setBitmapData(i),0==this.i?(this.backGroundImg=new egret.Bitmap(s),this.addChildAt(this.backGroundImg,this.i),this.backGroundImg.height=this.stage.stageHeight,this.backGroundImg.width=this.stage.stageWidth,this.land.load("resource/assets/loadViewWidth/land.png")):1==this.i?(this.landImg=new egret.Bitmap(s),this.addChildAt(this.landImg,this.i),this.landImg.x=(this.stage.stageWidth-this.landImg.width)/2,this.landImg.y=.78*this.stage.stageHeight,this.grassLand.load("resource/assets/loadViewWidth/grassLand.png")):2==this.i?(this.grassLandImg=new egret.Bitmap(s),this.addChildAt(this.grassLandImg,this.i),this.grassLandImg.x=(this.stage.stageWidth-this.grassLandImg.width)/2,this.grassLandImg.y=.78*this.stage.stageHeight-40,this.grassLandMask.load("resource/assets/loadViewWidth/grassLandMask.png")):3==this.i?(this.grassLandMaskImg=new egret.Bitmap(s),this.addChildAt(this.grassLandMaskImg,this.i),this.grassLandMaskImg.x=this.grassLandImg.x,this.grassLandMaskImg.y=this.grassLandImg.y,this.grassLandMaskImg.scaleX=0,this.grassLandImg.mask=this.grassLandMaskImg,this.grass.load("resource/assets/loadViewWidth/grass.png")):4==this.i&&(this.grassImg=new egret.Bitmap(s),this.addChildAt(this.grassImg,this.i),this.grassImg.x=this.grassLandMaskImg.x+this.grassLandMaskImg.width*this.grassLandMaskImg.scaleX-this.grassImg.width/2,this.grassImg.y=this.grassLandMaskImg.y,this.load=!0),this.i++},t.prototype.onProgress=function(e,t){var i=e/t;this.load&&(this.grassLandMaskImg.scaleX=i,this.grassImg.x=this.grassLandMaskImg.x+this.grassLandMaskImg.width*i-this.grassImg.width/2)},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var PlaySound=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return null==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.randomPlaySound=function(){var e=Math.floor(7*Math.random()),t=null;switch(e){case 0:t="soundMove1_mp3";break;case 1:t="soundMove2_mp3";break;case 2:t="soundMove3_mp3";break;case 3:t="soundMove4_mp3";break;case 4:t="soundMove5_mp3";break;case 5:t="soundMove6_mp3";break;case 6:t="soundMove7_mp3"}SoundManager.getInstance().playEffect(t)},e}();__reflect(PlaySound.prototype,"PlaySound");var ReverseMask=function(e){function t(){var t=e.call(this)||this;return t.explainBit=null,t.knowBtn=null,t.skipBtn=null,t.helpIm=null,t.initState=0,t.state=0,t.isClick=!1,t.container=new egret.DisplayObjectContainer,t.shade=null,Message.instance.add(MsgCMD.CHANGE_REVERNASK_STATE,t),Message.instance.add(MsgCMD.CHANGE_REVERNASK_STATE_YELLOW,t),t}return __extends(t,e),t.prototype.recvMsg=function(e,t){switch(e){case MsgCMD.CHANGE_REVERNASK_STATE:this.maskState();break;case MsgCMD.CHANGE_REVERNASK_STATE_YELLOW:this.state=200,this.visible=!1,this.touchEnabled=!1}},t.prototype.createGuide=function(e){var t=this;switch(this.initState=e,this.initState){case 0:this.reverseMask(238,-3,100,100),this.explainBit=new egret.Bitmap(RES.getRes("score_png")),this.addChildAt(this.explainBit,5),this.explainBit.x=300,this.explainBit.y=80,this.knowBtn=new eui.Button,this.addChildAt(this.knowBtn,5),this.knowBtn.iconDisplay.source="ikonwBtn_png",this.knowBtn.anchorOffsetX=this.knowBtn.width/2,this.knowBtn.anchorOffsetY=this.knowBtn.height/2,this.knowBtn.x=450,this.knowBtn.y=300,this.knowBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.maskState,this),this.skipBtn=new eui.Button,this.addChildAt(this.skipBtn,5),this.skipBtn.iconDisplay.source="skipBtn_png",this.skipBtn.anchorOffsetX=this.skipBtn.width/2,this.skipBtn.anchorOffsetY=this.skipBtn.height/2,this.skipBtn.x=800,this.skipBtn.y=40,this.skipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skipHandler,this),this.helpIm=new egret.Bitmap(RES.getRes("help_1_png")),this.addChild(this.helpIm),this.helpIm.anchorOffsetX=0,this.helpIm.anchorOffsetY=this.helpIm.height,this.helpIm.x=470,this.helpIm.y=200,this.helpIm.visible=!1;break;case 1:this.reverseMask(320,25,100,100),this.explainBit=new egret.Bitmap(RES.getRes("quickLevel_png")),this.addChildAt(this.explainBit,5),this.explainBit.x=270,this.explainBit.y=130,this.helpIm=new egret.Bitmap(RES.getRes("help_1_png")),this.addChild(this.helpIm),this.helpIm.anchorOffsetX=0,this.helpIm.anchorOffsetY=this.helpIm.height,this.helpIm.scaleY=-1,this.helpIm.scaleX=-1,this.helpIm.rotation=-70,this.helpIm.visible=!1,this.state=100,this.maskState();break;case 2:this.reverseMask(630,180,100,100),this.helpIm=new egret.Bitmap(RES.getRes("help_1_png")),this.addChild(this.helpIm),this.helpIm.anchorOffsetX=0,this.helpIm.anchorOffsetY=this.helpIm.height,this.helpIm.scaleY=-1,this.helpIm.scaleX=-1,this.helpIm.rotation=-70,this.helpIm.visible=!1,this.state=101,this.maskState();break;case 3:this.reverseMask(427,70,60,60),this.helpIm=new egret.Bitmap(RES.getRes("help_1_png")),this.addChild(this.helpIm),this.helpIm.anchorOffsetX=0,this.helpIm.anchorOffsetY=this.helpIm.height,this.helpIm.scaleY=-1,this.helpIm.scaleX=-1,this.helpIm.rotation=-70,this.helpIm.visible=!1,this.state=7,this.maskState();break;case 4:this.reverseMask(425,255,70,70),this.explainBit=new egret.Bitmap(RES.getRes("tips2_png")),this.addChildAt(this.explainBit,5),this.explainBit.x=60,this.explainBit.y=245,this.knowBtn=new eui.Button,this.addChildAt(this.knowBtn,5),this.knowBtn.iconDisplay.source="ikonwBtn_png",this.knowBtn.anchorOffsetX=this.knowBtn.width/2,this.knowBtn.anchorOffsetY=this.knowBtn.height/2,this.knowBtn.x=800,this.knowBtn.y=350,this.knowBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.state=200,t.visible=!1,t.touchEnabled=!1},this)}},t.prototype.getState=function(){return this.state},t.prototype.maskState=function(){switch(this.initState<1&&(1==this.knowBtn.visible&&(GameDateManager.instance.getIsPlayMusic()&&SoundManager.getInstance().playEffect("soundClick_mp3"),egret.Tween.get(this.knowBtn,{loop:!1}).to({scaleX:.9,scaleY:.9},100,egret.Ease.backOut).to({scaleX:1,scaleY:1},100,egret.Ease.backOut)),this.state++),this.state){case 1:this.reverseMask(583,-3,100,100),this.explainBit.texture=RES.getRes("baseScore_png"),this.explainBit.x=630,this.explainBit.y=90;break;case 2:this.reverseMask(75,360,100,100),this.explainBit.texture=RES.getRes("revoke_png"),this.explainBit.x=65,this.explainBit.y=245;break;case 3:this.reverseMask(223,360,100,100),this.explainBit.texture=RES.getRes("reset_png"),this.explainBit.x=65,this.explainBit.y=225;break;case 4:this.knowBtn.touchEnabled=!1,this.knowBtn.visible=!1,this.helpIm&&(this.helpIm.visible=!0,egret.Tween.get(this.helpIm,{loop:!0}).to({scaleX:.8,scaleY:.8},600,egret.Ease.backOut).to({scaleX:1,scaleY:1},600,egret.Ease.backOut)),this.reverseMask(420,173,80,80),this.explainBit.texture=RES.getRes("click1_png"),this.explainBit.x=330,this.explainBit.y=50;break;case 5:this.helpIm.visible=!1,this.knowBtn.touchEnabled=!0,this.knowBtn.visible=!0,this.knowBtn.x=800,this.knowBtn.y=350,this.reverseMask(420,250,80,80),this.explainBit.texture=RES.getRes("tips5_png"),this.explainBit.x=330,this.explainBit.y=130;break;case 6:break;case 7:this.helpIm.x=470,this.helpIm.y=110,this.helpIm.visible=!0,egret.Tween.get(this.helpIm,{loop:!0}).to({scaleX:-.8,scaleY:-.8},600,egret.Ease.backOut).to({scaleX:-1,scaleY:-1},600,egret.Ease.backOut);break;case 100:this.helpIm.x=395,this.helpIm.y=93,this.helpIm.visible=!0,egret.Tween.get(this.helpIm,{loop:!0}).to({scaleX:-.8,scaleY:-.8},600,egret.Ease.backOut).to({scaleX:-1,scaleY:-1},600,egret.Ease.backOut);break;case 101:this.helpIm.x=700,this.helpIm.y=250,this.helpIm.visible=!0,egret.Tween.get(this.helpIm,{loop:!0}).to({scaleX:-.8,scaleY:-.8},600,egret.Ease.backOut).to({scaleX:-1,scaleY:-1},600,egret.Ease.backOut);break;case 102:this.helpIm.x=450,this.helpIm.y=80,this.helpIm.visible=!0,egret.Tween.get(this.helpIm,{loop:!0}).to({scaleX:-.8,scaleY:-.8},600,egret.Ease.backOut).to({scaleX:-1,scaleY:-1},600,egret.Ease.backOut)}6==this.state&&Message.instance.send(MsgCMD.PASS_THROUGH)},t.prototype.skipHandler=function(e){var t=this;this.isClick||(this.isClick=!this.isClick,GameDateManager.instance.getIsPlayMusic()&&SoundManager.getInstance().playEffect("soundClick_mp3"),egret.Tween.get(this.skipBtn,{loop:!1}).wait(100).to({scaleX:.8,scaleY:.8},150,egret.Ease.backOut).call(function(){t.state=200,t.parent.removeChild(t)}))},t.prototype.reverseMask=function(e,t,i,s){this.container.removeChildren();var n=new egret.Shape;n.graphics.beginFill(0,.5),n.graphics.drawRect(0,0,900,480),n.graphics.endFill(),this.container.addChild(n);var r=new egret.Shape;r.graphics.beginFill(0,1),r.graphics.drawEllipse(e,t,i,s),r.graphics.endFill(),r.blendMode=egret.BlendMode.ERASE,this.container.addChild(r);var o=new egret.RenderTexture;o.drawToTexture(this.container),this.shade||(this.shade=new egret.Bitmap,this.addChild(this.shade)),this.shade.texture=o,this.shade.touchEnabled=!0,this.shade.pixelHitTest=!0},t}(egret.DisplayObjectContainer);__reflect(ReverseMask.prototype,"ReverseMask",["IMessage"]);var Block_1=function(e){function t(t,i,s){var n=e.call(this)||this;return n.blockState=1,n.redBlockArr=null,n.blockMg=MainGame.game.BlockMg,n.npcMg=MainGame.game.NpcMg,n.indexX=t,n.indexY=i,n.direction=s,n.colourType=1,n.redBlockArr=new Array,n}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this._tempConfig=new Array,this.init(),this.addMessage(MsgCMD.CHANGE_POSITION_YELLOW,this),this.addMessage(MsgCMD.CHANGE_POSITION_BLUE,this),this.addMessage(MsgCMD.CHANGE_POSITION_GREEN,this),this.addMessage(MsgCMD.CHANGE_POSITION_PINK,this)},t.prototype.recvMsg=function(e,t){switch(e){case MsgCMD.CHANGE_POSITION_YELLOW:case MsgCMD.CHANGE_POSITION_GREEN:case MsgCMD.CHANGE_POSITION_PINK:case MsgCMD.CHANGE_POSITION_BLUE:egret.setTimeout(function(){this.cleanAndAdd()},this,30)}},t.prototype.init=function(){this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.blockShadow=new egret.Bitmap(RES.getRes("shadow_png")),this.addChild(this.blockShadow),this.blockShadow.anchorOffsetX=this.blockShadow.width/2,this.blockShadow.anchorOffsetY=this.blockShadow.height/2,this.blockShadow.width=.75*this.blockShadow.width,this.blockShadow.height=.75*this.blockShadow.height,this.blockShadow.x=-8,this.blockShadow.y=8,this.block=new egret.Bitmap(RES.getRes("redNpc_png")),this.addChild(this.block),this.block.anchorOffsetX=this.block.width/2,this.block.anchorOffsetY=this.block.height/2,this.block.width=.8*this.block.width,this.block.height=.8*this.block.height,this.block.pixelHitTest=!0,this.width=this.block.width,this.height=this.block.height,this.triangle=new egret.Bitmap(RES.getRes("triangle_png")),this.triangle.anchorOffsetX=this.triangle.width/2,this.triangle.anchorOffsetY=this.triangle.height/2,this.changeTriangleDirection(this.direction),this.addChild(this.triangle),this.blockPosition(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.refresh,this),this.addListener(this,egret.Event.ENTER_FRAME,this.update,this),egret.setTimeout(function(){this.checkBlockAdjoin(this.indexX,this.indexY,this.direction);for(var e=0;e<this.redBlockArr.length;e++){var t=this.redBlockArr[e].indexX,i=this.redBlockArr[e].indexY;this.checkBlockAdjoin(t,i,this.direction)}},this,500),this.isInFrame(),this._tempConfig=this.npcMg.Config,this.changeDirectionAndInto()},t.prototype.blockPosition=function(){this.x=this.indexX*this.block.width-12*this.indexX+this.offsetX,this.indexX%2?this.y=this.indexY*this.block.height+6*this.indexY:this.y=this.indexY*this.block.height+this.offsetY+6*this.indexY},t.prototype.refresh=function(){this.isRefreshPosition=!0,egret.setTimeout(function(){this.otherBlockIsRefreshPosition()||this.refreshPosition(),this.isRefreshPosition=!1},this,40)},t.prototype.refreshPosition=function(){var e=this;if(!MainGame.game.isGameOver()&&MainGame.game.zoomSprite.scaleX>=.25){if(GameDateManager.instance.getIsPlayMusic()&&PlaySound.instance.randomPlaySound(),BackBlock.instance.clickBlockEnterQueue(this,this.indexX,this.indexY,this.direction),this.cleanAndAdd(),0==this.direction){this.redBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.redBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var t=0;t<this.redBlockArr.length;t++){var i=this.redBlockArr[t].indexX,s=this.redBlockArr[t].indexY,n=this.redBlockArr[t].direction;BackBlock.instance.clickBlockEnterQueue(this.redBlockArr[t],i,s,n),this.redBlockArr[t].changePosition(i,s+1)}}if(1==this.direction){this.redBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.redBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var t=0;t<this.redBlockArr.length;t++){var i=this.redBlockArr[t].indexX,s=this.redBlockArr[t].indexY,n=this.redBlockArr[t].direction;BackBlock.instance.clickBlockEnterQueue(this.redBlockArr[t],i,s,n),this.redBlockArr[t].changePosition(i,s-1)}}if(2==this.direction){this.redBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.redBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var t=0;t<this.redBlockArr.length;t++){var i=this.redBlockArr[t].indexX,s=this.redBlockArr[t].indexY,n=this.redBlockArr[t].direction;BackBlock.instance.clickBlockEnterQueue(this.redBlockArr[t],i,s,n),i%2==0&&this.redBlockArr[t].changePosition(i+1,s+1),i%2!=0&&this.redBlockArr[t].changePosition(i+1,s)}}if(3==this.direction){this.redBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.redBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var t=0;t<this.redBlockArr.length;t++){var i=this.redBlockArr[t].indexX,s=this.redBlockArr[t].indexY,n=this.redBlockArr[t].direction;BackBlock.instance.clickBlockEnterQueue(this.redBlockArr[t],i,s,n),i%2==0&&this.redBlockArr[t].changePosition(i+1,s),i%2!=0&&this.redBlockArr[t].changePosition(i+1,s-1)}}if(4==this.direction){this.redBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.redBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var t=0;t<this.redBlockArr.length;t++){var i=this.redBlockArr[t].indexX,s=this.redBlockArr[t].indexY,n=this.redBlockArr[t].direction;BackBlock.instance.clickBlockEnterQueue(this.redBlockArr[t],i,s,n),i%2==0&&this.redBlockArr[t].changePosition(i-1,s+1),i%2!=0&&this.redBlockArr[t].changePosition(i-1,s)}}if(5==this.direction){this.redBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.redBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var t=0;t<this.redBlockArr.length;t++){var i=this.redBlockArr[t].indexX,s=this.redBlockArr[t].indexY,n=this.redBlockArr[t].direction;BackBlock.instance.clickBlockEnterQueue(this.redBlockArr[t],i,s,n),i%2==0&&this.redBlockArr[t].changePosition(i-1,s),i%2!=0&&this.redBlockArr[t].changePosition(i-1,s-1)}}this.changeIndex(),this.indexX%2==0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+this.offsetY+6*this.indexY},200,egret.Ease.backOut).call(function(){egret.Tween.removeTweens(e)}),this.indexX%2!=0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+6*this.indexY},200,egret.Ease.backOut).call(function(){egret.Tween.removeTweens(e)}),this.changeDirectionAndInto(),this.changeTriangleDirection(this.direction),this.isInFrame(),MainGame.game&&egret.setTimeout(function(){this.changeSceneSize()},this,100),egret.log("this.scaleCoefficient=",this.scaleCoefficient),Message.instance.send(MsgCMD.CHANGE_POSITION_RED),1==MainGame.game.getLevelId()&&Message.instance.send(MsgCMD.CHANGE_REVERNASK_STATE)}},t.prototype.changeSceneSize=function(){var e=null,t=null;e=new Array,t=new Array;for(var i=0,s=0,n=0,r=0,o=this.scaleCoefficient,h=this.scaleCoefficient,a=this.scaleCoefficient,c=this.scaleCoefficient,l=1,d=1,g=0;g<this.blockMg.BlockArr.length;g++)e.push(this.blockMg.BlockArr[g].indexX),t.push(this.blockMg.BlockArr[g].indexY);if(this.sort(e),this.sort(t),n=e[0],r=t[0],i=e[e.length-1],s=t[t.length-1],s>4||2>r){if(s>4)for(var p=s-4,g=0;p-1>g;g++)h*=this.scaleCoefficient;if(2>r)for(var p=Math.abs(r-2),g=0;p-1>g;g++)c*=this.scaleCoefficient;d=h>c?c:h}if(i>8||2>n){if(i>8)for(var p=i-8,g=0;p-1>g;g++)o*=this.scaleCoefficient;if(2>n)for(var p=Math.abs(n-2),g=0;p-1>g;g++)a*=this.scaleCoefficient;l=o>a?a:o}l>d?(egret.Tween.get(MainGame.game.zoomSprite,{loop:!1}).to({scaleX:d,scaleY:d},100),egret.log("_indexYScale=",d)):(egret.Tween.get(MainGame.game.zoomSprite,{loop:!1}).to({scaleX:l,scaleY:l},100),egret.log("_indexXScale=",l))},t.prototype.sort=function(e){for(var t=0;t<e.length-1;t++)for(var i=0;i<e.length-t-1;i++)e[i]>e[i+1]&&(e[i]=e[i]+e[i+1],e[i+1]=e[i]-e[i+1],e[i]=e[i]-e[i+1])},t.prototype.changeDirectionAndInto=function(){if(this._tempConfig)for(var e=0;e<this._tempConfig.length;e+=4){if(this._tempConfig[e]+1==this.colourType&&this.indexX==this._tempConfig[e+1]&&this.indexY==this._tempConfig[e+2]){egret.setTimeout(function(){this.isInto=!0},this,50);break}this.isInto=!1}if(this._tempConfig)for(var e=0;e<this._tempConfig.length;e+=4)if(5==this._tempConfig[e]&&this.indexX==this._tempConfig[e+1]&&this.indexY==this._tempConfig[e+2]){this.direction=this._tempConfig[e+3];break}},t.prototype.changeTriangleDirection=function(e){this.direction=e,0==this.direction&&(this.triangle.x=-10,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:90},500,egret.Ease.bounceOut)),1==this.direction&&(this.triangle.x=-10,this.triangle.y=-10,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-90},500,egret.Ease.bounceOut)),2==this.direction&&(this.triangle.x=-5,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:30},500,egret.Ease.bounceOut)),3==this.direction&&(this.triangle.x=-5,this.triangle.y=-10,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-30},500,egret.Ease.bounceOut)),4==this.direction&&(this.triangle.x=-15,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:150},500,egret.Ease.bounceOut)),5==this.direction&&(this.triangle.x=-15,this.triangle.y=-12,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-150},500,egret.Ease.bounceOut))},t.prototype.changeIndex=function(){if(0==this.direction&&this.indexY++,1==this.direction&&this.indexY--,2==this.direction){if(this.indexX%2==0)return this.indexX++,void this.indexY++;if(this.indexX%2!=0)return void this.indexX++}if(3==this.direction){if(this.indexX%2==0)return void this.indexX++;if(this.indexX%2!=0)return this.indexX++,void this.indexY--}if(4==this.direction){if(this.indexX%2==0)return this.indexX--,void this.indexY++;if(this.indexX%2!=0)return void this.indexX--}if(5==this.direction){if(this.indexX%2==0)return void this.indexX--;if(this.indexX%2!=0)return this.indexX--,void this.indexY--}},t.prototype.changePosition=function(e,t,i){this.indexX=e,this.indexY=t,this.indexX%2==0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+this.offsetY+6*this.indexY},300,egret.Ease.backOut),this.indexX%2!=0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+6*this.indexY},300,egret.Ease.backOut),this.changeDirectionAndInto(),MainGame.game&&egret.setTimeout(function(){this.changeSceneSize()},this,100),i>=0?this.changeTriangleDirection(i):this.changeTriangleDirection(this.direction),this.isInFrame(),Message.instance.send(MsgCMD.CHANGE_POSITION_RED)},t.prototype.cleanAndAdd=function(){this.cleanBlock(),this.checkBlockAdjoin(this.indexX,this.indexY,this.direction);for(var e=0;e<this.redBlockArr.length;e++){var t=this.redBlockArr[e].indexX,i=this.redBlockArr[e].indexY;this.checkBlockAdjoin(t,i,this.direction)}},t.prototype.update=function(){MainGame.game&&(MainGame.game.zoomSprite.scaleX>=.5&&(this.scaleCoefficient=.8),MainGame.game.zoomSprite.scaleX<.5&&(this.scaleCoefficient=.81),MainGame.game.zoomSprite.scaleX<.4&&(this.scaleCoefficient=.82))},t.prototype.isInFrame=function(){if(this.npcMg)for(var e=0;e<this.npcMg.NpcArr.length;e++){if(null!=this.npcMg.NpcArr[e]&&this.npcMg.NpcArr[e].colourType<6&&this.indexX==this.npcMg.NpcArr[e].indexX&&this.indexY==this.npcMg.NpcArr[e].indexY){this.scaleX=this.scaleY=.8,this.block.x=this.block.y=-2,this.blockShadow.visible=!1;break}this.scaleX=this.scaleY=1,this.block.x=this.block.y=0,this.blockShadow.visible=!0}},t.prototype.cleanBlock=function(){var e=this.redBlockArr.length;this.redBlockArr.splice(0,e)},t.prototype.checkBlockAdjoin=function(e,t,i){for(var s=this.blockMg.BlockArr,n=0;n<s.length;n++)0==i&&(s[n].indexX!=e||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.redBlockArr.push(s[n])),1==i&&(s[n].indexX!=e||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.redBlockArr.push(s[n])),2==i&&(e%2==0&&(s[n].indexX!=e+1||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.redBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e+1||s[n].indexY!=t||this.isHasBlock(s[n])||this.redBlockArr.push(s[n]))),3==i&&(e%2==0&&(s[n].indexX!=e+1||s[n].indexY!=t||this.isHasBlock(s[n])||this.redBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e+1||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.redBlockArr.push(s[n]))),4==i&&(e%2==0&&(s[n].indexX!=e-1||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.redBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e-1||s[n].indexY!=t||this.isHasBlock(s[n])||this.redBlockArr.push(s[n]))),5==i&&(e%2==0&&(s[n].indexX!=e-1||s[n].indexY!=t||this.isHasBlock(s[n])||this.redBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e-1||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.redBlockArr.push(s[n])))},t.prototype.isHasBlock=function(e){for(var t=this.redBlockArr,i=0;i<t.length;i++)if(e==t[i])return!0;return!1},t.prototype.otherBlockIsRefreshPosition=function(){for(var e=0;e<this.blockMg.BlockArr.length;e++)if(this.blockMg.BlockArr[e]!=this&&1==this.blockMg.BlockArr[e].isRefreshPosition)return!0;return!1},t}(Block);__reflect(Block_1.prototype,"Block_1",["IMessage"]);var Block_2=function(e){function t(t,i,s){var n=e.call(this)||this;return n.blockState=1,n.blueBlockArr=null,n.blockMg=MainGame.game.BlockMg,n.npcMg=MainGame.game.NpcMg,n.indexX=t,n.indexY=i,n.direction=s,n.colourType=2,n.blueBlockArr=new Array,n}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this._tempConfig=new Array,this.init(),this.addMessage(MsgCMD.CHANGE_POSITION_RED,this),this.addMessage(MsgCMD.CHANGE_POSITION_YELLOW,this),this.addMessage(MsgCMD.CHANGE_POSITION_GREEN,this),this.addMessage(MsgCMD.CHANGE_POSITION_PINK,this)},t.prototype.recvMsg=function(e,t){switch(e){case MsgCMD.CHANGE_POSITION_YELLOW:case MsgCMD.CHANGE_POSITION_GREEN:case MsgCMD.CHANGE_POSITION_PINK:case MsgCMD.CHANGE_POSITION_RED:egret.setTimeout(function(){this.cleanAndAdd()},this,30)}},t.prototype.init=function(){this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.blockShadow=new egret.Bitmap(RES.getRes("shadow_png")),this.addChild(this.blockShadow),this.blockShadow.anchorOffsetX=this.blockShadow.width/2,this.blockShadow.anchorOffsetY=this.blockShadow.height/2,this.blockShadow.width=.75*this.blockShadow.width,this.blockShadow.height=.75*this.blockShadow.height,this.blockShadow.x=-8,this.blockShadow.y=8,this.block=new egret.Bitmap(RES.getRes("blueNpc_png")),this.addChild(this.block),this.block.anchorOffsetX=this.block.width/2,this.block.anchorOffsetY=this.block.height/2,this.block.width=.8*this.block.width,this.block.height=.8*this.block.height,this.block.pixelHitTest=!0,this.width=this.block.width,this.height=this.block.height,this.triangle=new egret.Bitmap(RES.getRes("triangle_png")),this.triangle.anchorOffsetX=this.triangle.width/2,this.triangle.anchorOffsetY=this.triangle.height/2,this.triangle.x=-10,this.triangle.y=-5,this.changeTriangleDirection(this.direction),this.addChild(this.triangle),this.blockPosition(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.refresh,this),this.addListener(this,egret.Event.ENTER_FRAME,this.update,this);egret.setTimeout(function(){this.checkBlockAdjoin(this.indexX,this.indexY,this.direction);for(var e=0;e<this.blueBlockArr.length;e++){var t=this.blueBlockArr[e].indexX,i=this.blueBlockArr[e].indexY;this.checkBlockAdjoin(t,i,this.direction)}},this,500);this.isInFrame(),this._tempConfig=this.npcMg.Config,this.changeDirectionAndInto()},t.prototype.blockPosition=function(){this.x=this.indexX*this.block.width-12*this.indexX+this.offsetX,this.indexX%2?this.y=this.indexY*this.block.height+6*this.indexY:this.y=this.indexY*this.block.height+this.offsetY+6*this.indexY},t.prototype.refresh=function(){this.isRefreshPosition=!0,egret.setTimeout(function(){this.otherBlockIsRefreshPosition()||this.refreshPosition(),this.isRefreshPosition=!1},this,40)},t.prototype.refreshPosition=function(){if(!MainGame.game.isGameOver()&&MainGame.game.zoomSprite.scaleX>=.25){if(GameDateManager.instance.getIsPlayMusic()&&PlaySound.instance.randomPlaySound(),BackBlock.instance.clickBlockEnterQueue(this,this.indexX,this.indexY,this.direction),this.cleanAndAdd(),0==this.direction){this.blueBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.blueBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.blueBlockArr.length;e++){var t=this.blueBlockArr[e].indexX,i=this.blueBlockArr[e].indexY,s=this.blueBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.blueBlockArr[e],t,i,s),this.blueBlockArr[e].changePosition(t,i+1)}}if(1==this.direction){this.blueBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.blueBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.blueBlockArr.length;e++){var t=this.blueBlockArr[e].indexX,i=this.blueBlockArr[e].indexY,s=this.blueBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.blueBlockArr[e],t,i,s),this.blueBlockArr[e].changePosition(t,i-1)}}if(2==this.direction){this.blueBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.blueBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.blueBlockArr.length;e++){var t=this.blueBlockArr[e].indexX,i=this.blueBlockArr[e].indexY,s=this.blueBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.blueBlockArr[e],t,i,s),t%2==0&&this.blueBlockArr[e].changePosition(t+1,i+1),t%2!=0&&this.blueBlockArr[e].changePosition(t+1,i)}}if(3==this.direction){this.blueBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.blueBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.blueBlockArr.length;e++){var t=this.blueBlockArr[e].indexX,i=this.blueBlockArr[e].indexY,s=this.blueBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.blueBlockArr[e],t,i,s),t%2==0&&this.blueBlockArr[e].changePosition(t+1,i),t%2!=0&&this.blueBlockArr[e].changePosition(t+1,i-1)}}if(4==this.direction){this.blueBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.blueBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.blueBlockArr.length;e++){var t=this.blueBlockArr[e].indexX,i=this.blueBlockArr[e].indexY,s=this.blueBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.blueBlockArr[e],t,i,s),t%2==0&&this.blueBlockArr[e].changePosition(t-1,i+1),t%2!=0&&this.blueBlockArr[e].changePosition(t-1,i)}}if(5==this.direction){this.blueBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.blueBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.blueBlockArr.length;e++){var t=this.blueBlockArr[e].indexX,i=this.blueBlockArr[e].indexY,s=this.blueBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.blueBlockArr[e],t,i,s),t%2==0&&this.blueBlockArr[e].changePosition(t-1,i),t%2!=0&&this.blueBlockArr[e].changePosition(t-1,i-1)}}this.changeIndex(),this.indexX%2==0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+this.offsetY+6*this.indexY},200,egret.Ease.backOut),this.indexX%2!=0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+6*this.indexY},200,egret.Ease.backOut),this.changeDirectionAndInto(),this.changeTriangleDirection(this.direction),this.isInFrame(),MainGame.game&&egret.setTimeout(function(){this.changeSceneSize()},this,100),Message.instance.send(MsgCMD.CHANGE_POSITION_BLUE)}},t.prototype.changeSceneSize=function(){var e=null,t=null;e=new Array,t=new Array;for(var i=0,s=0,n=0,r=0,o=this.scaleCoefficient,h=this.scaleCoefficient,a=this.scaleCoefficient,c=this.scaleCoefficient,l=1,d=1,g=0;g<this.blockMg.BlockArr.length;g++)e.push(this.blockMg.BlockArr[g].indexX),t.push(this.blockMg.BlockArr[g].indexY);if(this.sort(e),this.sort(t),n=e[0],r=t[0],i=e[e.length-1],s=t[t.length-1],s>4||2>r){if(s>4)for(var p=s-4,g=0;p-1>g;g++)h*=this.scaleCoefficient;if(2>r)for(var p=Math.abs(r-2),g=0;p-1>g;g++)c*=this.scaleCoefficient;d=h>c?c:h}if(i>8||2>n){if(i>8)for(var p=i-8,g=0;p-1>g;g++)o*=this.scaleCoefficient;if(2>n)for(var p=Math.abs(n-2),g=0;p-1>g;g++)a*=this.scaleCoefficient;l=o>a?a:o}l>d?(egret.Tween.get(MainGame.game.zoomSprite,{loop:!1}).to({scaleX:d,scaleY:d},100),egret.log("_indexYScale=",d)):(egret.Tween.get(MainGame.game.zoomSprite,{loop:!1}).to({scaleX:l,scaleY:l},100),egret.log("_indexXScale=",l))},t.prototype.sort=function(e){for(var t=0;t<e.length-1;t++)for(var i=0;i<e.length-t-1;i++)e[i]>e[i+1]&&(e[i]=e[i]+e[i+1],e[i+1]=e[i]-e[i+1],e[i]=e[i]-e[i+1])},t.prototype.changeDirectionAndInto=function(){if(this._tempConfig)for(var e=0;e<this._tempConfig.length;e+=4){if(this._tempConfig[e]+1==this.colourType&&this.indexX==this._tempConfig[e+1]&&this.indexY==this._tempConfig[e+2]){egret.setTimeout(function(){this.isInto=!0
},this,50);break}this.isInto=!1}if(this._tempConfig)for(var e=0;e<this._tempConfig.length;e+=4)if(5==this._tempConfig[e]&&this.indexX==this._tempConfig[e+1]&&this.indexY==this._tempConfig[e+2]){this.direction=this._tempConfig[e+3];break}},t.prototype.changeTriangleDirection=function(e){this.direction=e,0==this.direction&&(this.triangle.x=-10,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:90},500,egret.Ease.bounceOut)),1==this.direction&&(this.triangle.x=-10,this.triangle.y=-10,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-90},500,egret.Ease.bounceOut)),2==this.direction&&(this.triangle.x=-5,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:30},500,egret.Ease.bounceOut)),3==this.direction&&(this.triangle.x=-5,this.triangle.y=-10,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-30},500,egret.Ease.bounceOut)),4==this.direction&&(this.triangle.x=-15,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:150},500,egret.Ease.bounceOut)),5==this.direction&&(this.triangle.x=-15,this.triangle.y=-12,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-150},500,egret.Ease.bounceOut))},t.prototype.changeIndex=function(){if(0==this.direction&&this.indexY++,1==this.direction&&this.indexY--,2==this.direction){if(this.indexX%2==0)return this.indexX++,void this.indexY++;if(this.indexX%2!=0)return void this.indexX++}if(3==this.direction){if(this.indexX%2==0)return void this.indexX++;if(this.indexX%2!=0)return this.indexX++,void this.indexY--}if(4==this.direction){if(this.indexX%2==0)return this.indexX--,void this.indexY++;if(this.indexX%2!=0)return void this.indexX--}if(5==this.direction){if(this.indexX%2==0)return void this.indexX--;if(this.indexX%2!=0)return this.indexX--,void this.indexY--}},t.prototype.changePosition=function(e,t,i){this.indexX=e,this.indexY=t,this.indexX%2==0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+this.offsetY+6*this.indexY},300,egret.Ease.backOut),this.indexX%2!=0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+6*this.indexY},300,egret.Ease.backOut),this.changeDirectionAndInto(),MainGame.game&&egret.setTimeout(function(){this.changeSceneSize()},this,100),i>=0?this.changeTriangleDirection(i):this.changeTriangleDirection(this.direction),this.isInFrame(),Message.instance.send(MsgCMD.CHANGE_POSITION_BLUE)},t.prototype.cleanAndAdd=function(){this.cleanBlock(),this.checkBlockAdjoin(this.indexX,this.indexY,this.direction);for(var e=0;e<this.blueBlockArr.length;e++){var t=this.blueBlockArr[e].indexX,i=this.blueBlockArr[e].indexY;this.checkBlockAdjoin(t,i,this.direction)}},t.prototype.update=function(){console.log("this._temp = ",this._tempConfig),MainGame.game&&(MainGame.game.zoomSprite.scaleX>=.5&&(this.scaleCoefficient=.8),MainGame.game.zoomSprite.scaleX<.5&&(this.scaleCoefficient=.81),MainGame.game.zoomSprite.scaleX<.4&&(this.scaleCoefficient=.82))},t.prototype.isInFrame=function(){if(this.npcMg)for(var e=0;e<this.npcMg.NpcArr.length;e++){if(null!=this.npcMg.NpcArr[e]&&this.npcMg.NpcArr[e].colourType<6&&this.indexX==this.npcMg.NpcArr[e].indexX&&this.indexY==this.npcMg.NpcArr[e].indexY){this.scaleX=this.scaleY=.8,this.block.x=this.block.y=-2,this.blockShadow.visible=!1;break}this.scaleX=this.scaleY=1,this.block.x=this.block.y=0,this.blockShadow.visible=!0}},t.prototype.cleanBlock=function(){var e=this.blueBlockArr.length;this.blueBlockArr.splice(0,e)},t.prototype.checkBlockAdjoin=function(e,t,i){for(var s=this.blockMg.BlockArr,n=0;n<s.length;n++)0==i&&(s[n].indexX!=e||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.blueBlockArr.push(s[n])),1==i&&(s[n].indexX!=e||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.blueBlockArr.push(s[n])),2==i&&(e%2==0&&(s[n].indexX!=e+1||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.blueBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e+1||s[n].indexY!=t||this.isHasBlock(s[n])||this.blueBlockArr.push(s[n]))),3==i&&(e%2==0&&(s[n].indexX!=e+1||s[n].indexY!=t||this.isHasBlock(s[n])||this.blueBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e+1||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.blueBlockArr.push(s[n]))),4==i&&(e%2==0&&(s[n].indexX!=e-1||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.blueBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e-1||s[n].indexY!=t||this.isHasBlock(s[n])||this.blueBlockArr.push(s[n]))),5==i&&(e%2==0&&(s[n].indexX!=e-1||s[n].indexY!=t||this.isHasBlock(s[n])||this.blueBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e-1||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.blueBlockArr.push(s[n])))},t.prototype.isHasBlock=function(e){for(var t=this.blueBlockArr,i=0;i<t.length;i++)if(e==t[i])return!0;return!1},t.prototype.otherBlockIsRefreshPosition=function(){for(var e=0;e<this.blockMg.BlockArr.length;e++)if(this.blockMg.BlockArr[e]!=this&&1==this.blockMg.BlockArr[e].isRefreshPosition)return!0;return!1},t}(Block);__reflect(Block_2.prototype,"Block_2",["IMessage"]);var Block_3=function(e){function t(t,i,s){var n=e.call(this)||this;return n.blockState=1,n.yellowBlockArr=null,n.blockMg=MainGame.game.BlockMg,n.npcMg=MainGame.game.NpcMg,n.indexX=t,n.indexY=i,n.direction=s,n.colourType=3,n.yellowBlockArr=new Array,n}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this._tempConfig=new Array,this.init(),this.addMessage(MsgCMD.CHANGE_POSITION_RED,this),this.addMessage(MsgCMD.CHANGE_POSITION_BLUE,this),this.addMessage(MsgCMD.CHANGE_POSITION_GREEN,this),this.addMessage(MsgCMD.CHANGE_POSITION_PINK,this)},t.prototype.recvMsg=function(e,t){switch(e){case MsgCMD.CHANGE_POSITION_RED:case MsgCMD.CHANGE_POSITION_GREEN:case MsgCMD.CHANGE_POSITION_PINK:case MsgCMD.CHANGE_POSITION_BLUE:egret.setTimeout(function(){this.cleanAndAdd()},this,30)}},t.prototype.init=function(){this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.blockShadow=new egret.Bitmap(RES.getRes("shadow_png")),this.addChild(this.blockShadow),this.blockShadow.anchorOffsetX=this.blockShadow.width/2,this.blockShadow.anchorOffsetY=this.blockShadow.height/2,this.blockShadow.width=.75*this.blockShadow.width,this.blockShadow.height=.75*this.blockShadow.height,this.blockShadow.x=-8,this.blockShadow.y=8,this.block=new egret.Bitmap(RES.getRes("yellowNpc_png")),this.addChild(this.block),this.block.anchorOffsetX=this.block.width/2,this.block.anchorOffsetY=this.block.height/2,this.block.width=.8*this.block.width,this.block.height=.8*this.block.height,this.block.pixelHitTest=!0,this.width=this.block.width,this.height=this.block.height,this.triangle=new egret.Bitmap(RES.getRes("triangle_png")),this.triangle.anchorOffsetX=this.triangle.width/2,this.triangle.anchorOffsetY=this.triangle.height/2,this.triangle.x=-10,this.triangle.y=-5,this.changeTriangleDirection(this.direction),this.addChild(this.triangle),this.blockPosition(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.refresh,this),this.addListener(this,egret.Event.ENTER_FRAME,this.update,this);egret.setTimeout(function(){this.checkBlockAdjoin(this.indexX,this.indexY,this.direction);for(var e=0;e<this.yellowBlockArr.length;e++){var t=this.yellowBlockArr[e].indexX,i=this.yellowBlockArr[e].indexY;this.checkBlockAdjoin(t,i,this.direction)}},this,500);this.isInFrame(),this._tempConfig=this.npcMg.Config,this.changeDirectionAndInto()},t.prototype.blockPosition=function(){this.x=this.indexX*this.block.width-12*this.indexX+this.offsetX,this.indexX%2?this.y=this.indexY*this.block.height+6*this.indexY:this.y=this.indexY*this.block.height+this.offsetY+6*this.indexY},t.prototype.refresh=function(){this.isRefreshPosition=!0,egret.setTimeout(function(){this.otherBlockIsRefreshPosition()||this.refreshPosition(),this.isRefreshPosition=!1},this,40)},t.prototype.refreshPosition=function(){if(!MainGame.game.isGameOver()&&MainGame.game.zoomSprite.scaleX>=.25){if(GameDateManager.instance.getIsPlayMusic()&&PlaySound.instance.randomPlaySound(),BackBlock.instance.clickBlockEnterQueue(this,this.indexX,this.indexY,this.direction),this.cleanAndAdd(),0==this.direction){this.yellowBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.yellowBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.yellowBlockArr.length;e++){var t=this.yellowBlockArr[e].indexX,i=this.yellowBlockArr[e].indexY,s=this.yellowBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.yellowBlockArr[e],t,i,s),this.yellowBlockArr[e].changePosition(t,i+1)}}if(1==this.direction){this.yellowBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.yellowBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.yellowBlockArr.length;e++){var t=this.yellowBlockArr[e].indexX,i=this.yellowBlockArr[e].indexY,s=this.yellowBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.yellowBlockArr[e],t,i,s),this.yellowBlockArr[e].changePosition(t,i-1)}}if(2==this.direction){this.yellowBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.yellowBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.yellowBlockArr.length;e++){var t=this.yellowBlockArr[e].indexX,i=this.yellowBlockArr[e].indexY,s=this.yellowBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.yellowBlockArr[e],t,i,s),t%2==0&&this.yellowBlockArr[e].changePosition(t+1,i+1),t%2!=0&&this.yellowBlockArr[e].changePosition(t+1,i)}}if(3==this.direction){this.yellowBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.yellowBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.yellowBlockArr.length;e++){var t=this.yellowBlockArr[e].indexX,i=this.yellowBlockArr[e].indexY,s=this.yellowBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.yellowBlockArr[e],t,i,s),t%2==0&&this.yellowBlockArr[e].changePosition(t+1,i),t%2!=0&&this.yellowBlockArr[e].changePosition(t+1,i-1)}}if(4==this.direction){this.yellowBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.yellowBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.yellowBlockArr.length;e++){var t=this.yellowBlockArr[e].indexX,i=this.yellowBlockArr[e].indexY,s=this.yellowBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.yellowBlockArr[e],t,i,s),t%2==0&&this.yellowBlockArr[e].changePosition(t-1,i+1),t%2!=0&&this.yellowBlockArr[e].changePosition(t-1,i)}}if(5==this.direction){this.yellowBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.yellowBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.yellowBlockArr.length;e++){var t=this.yellowBlockArr[e].indexX,i=this.yellowBlockArr[e].indexY,s=this.yellowBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.yellowBlockArr[e],t,i,s),t%2==0&&this.yellowBlockArr[e].changePosition(t-1,i),t%2!=0&&this.yellowBlockArr[e].changePosition(t-1,i-1)}}this.changeIndex(),this.indexX%2==0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+this.offsetY+6*this.indexY},200,egret.Ease.backOut),this.indexX%2!=0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+6*this.indexY},200,egret.Ease.backOut),this.changeDirectionAndInto(),this.changeTriangleDirection(this.direction),this.isInFrame(),MainGame.game&&egret.setTimeout(function(){this.changeSceneSize()},this,100),Message.instance.send(MsgCMD.CHANGE_POSITION_YELLOW),2==MainGame.game.getLevelId()&&Message.instance.send(MsgCMD.CHANGE_REVERNASK_STATE_YELLOW)}},t.prototype.changeSceneSize=function(){var e=null,t=null;e=new Array,t=new Array;for(var i=0,s=0,n=0,r=0,o=this.scaleCoefficient,h=this.scaleCoefficient,a=this.scaleCoefficient,c=this.scaleCoefficient,l=1,d=1,g=0;g<this.blockMg.BlockArr.length;g++)e.push(this.blockMg.BlockArr[g].indexX),t.push(this.blockMg.BlockArr[g].indexY);if(this.sort(e),this.sort(t),n=e[0],r=t[0],i=e[e.length-1],s=t[t.length-1],s>4||2>r){if(s>4)for(var p=s-4,g=0;p-1>g;g++)h*=this.scaleCoefficient;if(2>r)for(var p=Math.abs(r-2),g=0;p-1>g;g++)c*=this.scaleCoefficient;d=h>c?c:h}if(i>8||2>n){if(i>8)for(var p=i-8,g=0;p-1>g;g++)o*=this.scaleCoefficient;if(2>n)for(var p=Math.abs(n-2),g=0;p-1>g;g++)a*=this.scaleCoefficient;l=o>a?a:o}l>d?(egret.Tween.get(MainGame.game.zoomSprite,{loop:!1}).to({scaleX:d,scaleY:d},100),egret.log("_indexYScale=",d)):(egret.Tween.get(MainGame.game.zoomSprite,{loop:!1}).to({scaleX:l,scaleY:l},100),egret.log("_indexXScale=",l))},t.prototype.sort=function(e){for(var t=0;t<e.length-1;t++)for(var i=0;i<e.length-t-1;i++)e[i]>e[i+1]&&(e[i]=e[i]+e[i+1],e[i+1]=e[i]-e[i+1],e[i]=e[i]-e[i+1])},t.prototype.changeDirectionAndInto=function(){if(this._tempConfig)for(var e=0;e<this._tempConfig.length;e+=4){if(this._tempConfig[e]+1==this.colourType&&this.indexX==this._tempConfig[e+1]&&this.indexY==this._tempConfig[e+2]){egret.setTimeout(function(){this.isInto=!0},this,50);break}this.isInto=!1}if(this._tempConfig)for(var e=0;e<this._tempConfig.length;e+=4)if(5==this._tempConfig[e]&&this.indexX==this._tempConfig[e+1]&&this.indexY==this._tempConfig[e+2]){this.direction=this._tempConfig[e+3];break}},t.prototype.changeTriangleDirection=function(e){this.direction=e,0==this.direction&&(this.triangle.x=-10,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:90},500,egret.Ease.bounceOut)),1==this.direction&&(this.triangle.x=-10,this.triangle.y=-10,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-90},500,egret.Ease.bounceOut)),2==this.direction&&(this.triangle.x=-5,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:30},500,egret.Ease.bounceOut)),3==this.direction&&(this.triangle.x=-5,this.triangle.y=-10,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-30},500,egret.Ease.bounceOut)),4==this.direction&&(this.triangle.x=-15,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:150},500,egret.Ease.bounceOut)),5==this.direction&&(this.triangle.x=-15,this.triangle.y=-12,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-150},500,egret.Ease.bounceOut))},t.prototype.changeIndex=function(){if(0==this.direction&&this.indexY++,1==this.direction&&this.indexY--,2==this.direction){if(this.indexX%2==0)return this.indexX++,void this.indexY++;if(this.indexX%2!=0)return void this.indexX++}if(3==this.direction){if(this.indexX%2==0)return void this.indexX++;if(this.indexX%2!=0)return this.indexX++,void this.indexY--}if(4==this.direction){if(this.indexX%2==0)return this.indexX--,void this.indexY++;if(this.indexX%2!=0)return void this.indexX--}if(5==this.direction){if(this.indexX%2==0)return void this.indexX--;if(this.indexX%2!=0)return this.indexX--,void this.indexY--}},t.prototype.changePosition=function(e,t,i){this.indexX=e,this.indexY=t,this.indexX%2==0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+this.offsetY+6*this.indexY},300,egret.Ease.backOut),this.indexX%2!=0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+6*this.indexY},300,egret.Ease.backOut),this.changeDirectionAndInto(),MainGame.game&&egret.setTimeout(function(){this.changeSceneSize()},this,100),i>=0?this.changeTriangleDirection(i):this.changeTriangleDirection(this.direction),this.isInFrame(),Message.instance.send(MsgCMD.CHANGE_POSITION_YELLOW)},t.prototype.cleanAndAdd=function(){this.cleanBlock(),this.checkBlockAdjoin(this.indexX,this.indexY,this.direction);for(var e=0;e<this.yellowBlockArr.length;e++){var t=this.yellowBlockArr[e].indexX,i=this.yellowBlockArr[e].indexY;this.checkBlockAdjoin(t,i,this.direction)}},t.prototype.update=function(){MainGame.game&&(MainGame.game.zoomSprite.scaleX>=.5&&(this.scaleCoefficient=.8),MainGame.game.zoomSprite.scaleX<.5&&(this.scaleCoefficient=.81),MainGame.game.zoomSprite.scaleX<.4&&(this.scaleCoefficient=.82))},t.prototype.isInFrame=function(){if(this.npcMg)for(var e=0;e<this.npcMg.NpcArr.length;e++){if(null!=this.npcMg.NpcArr[e]&&this.npcMg.NpcArr[e].colourType<6&&this.indexX==this.npcMg.NpcArr[e].indexX&&this.indexY==this.npcMg.NpcArr[e].indexY){this.scaleX=this.scaleY=.8,this.block.x=this.block.y=-2,this.blockShadow.visible=!1;break}this.scaleX=this.scaleY=1,this.block.x=this.block.y=0,this.blockShadow.visible=!0}},t.prototype.cleanBlock=function(){var e=this.yellowBlockArr.length;this.yellowBlockArr.splice(0,e)},t.prototype.checkBlockAdjoin=function(e,t,i){for(var s=this.blockMg.BlockArr,n=0;n<s.length;n++)0==i&&(s[n].indexX!=e||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.yellowBlockArr.push(s[n])),1==i&&(s[n].indexX!=e||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.yellowBlockArr.push(s[n])),2==i&&(e%2==0&&(s[n].indexX!=e+1||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.yellowBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e+1||s[n].indexY!=t||this.isHasBlock(s[n])||this.yellowBlockArr.push(s[n]))),3==i&&(e%2==0&&(s[n].indexX!=e+1||s[n].indexY!=t||this.isHasBlock(s[n])||this.yellowBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e+1||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.yellowBlockArr.push(s[n]))),4==i&&(e%2==0&&(s[n].indexX!=e-1||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.yellowBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e-1||s[n].indexY!=t||this.isHasBlock(s[n])||this.yellowBlockArr.push(s[n]))),5==i&&(e%2==0&&(s[n].indexX!=e-1||s[n].indexY!=t||this.isHasBlock(s[n])||this.yellowBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e-1||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.yellowBlockArr.push(s[n])))},t.prototype.isHasBlock=function(e){for(var t=this.yellowBlockArr,i=0;i<t.length;i++)if(e==t[i])return!0;return!1},t.prototype.otherBlockIsRefreshPosition=function(){for(var e=0;e<this.blockMg.BlockArr.length;e++)if(this.blockMg.BlockArr[e]!=this&&1==this.blockMg.BlockArr[e].isRefreshPosition)return!0;return!1},t}(Block);__reflect(Block_3.prototype,"Block_3",["IMessage"]);var Block_4=function(e){function t(t,i,s){var n=e.call(this)||this;return n.blockState=1,n.greenBlockArr=null,n.blockMg=MainGame.game.BlockMg,n.npcMg=MainGame.game.NpcMg,n.indexX=t,n.indexY=i,n.direction=s,n.colourType=4,n.greenBlockArr=new Array,n}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this._tempConfig=new Array,this.init(),this.addMessage(MsgCMD.CHANGE_POSITION_RED,this),this.addMessage(MsgCMD.CHANGE_POSITION_BLUE,this),this.addMessage(MsgCMD.CHANGE_POSITION_PINK,this),this.addMessage(MsgCMD.CHANGE_POSITION_YELLOW,this)},t.prototype.recvMsg=function(e,t){switch(e){case MsgCMD.CHANGE_POSITION_RED:case MsgCMD.CHANGE_POSITION_YELLOW:case MsgCMD.CHANGE_POSITION_PINK:case MsgCMD.CHANGE_POSITION_BLUE:egret.setTimeout(function(){this.cleanAndAdd()},this,30)}},t.prototype.init=function(){this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.blockShadow=new egret.Bitmap(RES.getRes("shadow_png")),this.addChild(this.blockShadow),this.blockShadow.anchorOffsetX=this.blockShadow.width/2,this.blockShadow.anchorOffsetY=this.blockShadow.height/2,this.blockShadow.width=.75*this.blockShadow.width,this.blockShadow.height=.75*this.blockShadow.height,this.blockShadow.x=-8,this.blockShadow.y=8,this.block=new egret.Bitmap(RES.getRes("greenNpc_png")),this.addChild(this.block),this.block.anchorOffsetX=this.block.width/2,this.block.anchorOffsetY=this.block.height/2,this.block.width=.8*this.block.width,this.block.height=.8*this.block.height,this.block.pixelHitTest=!0,this.width=this.block.width,this.height=this.block.height,this.triangle=new egret.Bitmap(RES.getRes("triangle_png")),this.triangle.anchorOffsetX=this.triangle.width/2,this.triangle.anchorOffsetY=this.triangle.height/2,this.triangle.x=-10,this.triangle.y=-5,this.changeTriangleDirection(this.direction),this.addChild(this.triangle),this.blockPosition(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.refresh,this),this.addListener(this,egret.Event.ENTER_FRAME,this.update,this);egret.setTimeout(function(){this.checkBlockAdjoin(this.indexX,this.indexY,this.direction);for(var e=0;e<this.greenBlockArr.length;e++){var t=this.greenBlockArr[e].indexX,i=this.greenBlockArr[e].indexY;this.checkBlockAdjoin(t,i,this.direction)}},this,500);this.isInFrame(),this._tempConfig=this.npcMg.Config,this.changeDirectionAndInto()},t.prototype.blockPosition=function(){this.x=this.indexX*this.block.width-12*this.indexX+this.offsetX,this.indexX%2?this.y=this.indexY*this.block.height+6*this.indexY:this.y=this.indexY*this.block.height+this.offsetY+6*this.indexY},t.prototype.refresh=function(){this.isRefreshPosition=!0,egret.setTimeout(function(){this.otherBlockIsRefreshPosition()||this.refreshPosition(),this.isRefreshPosition=!1},this,40)},t.prototype.refreshPosition=function(){if(!MainGame.game.isGameOver()&&MainGame.game.zoomSprite.scaleX>=.25){if(GameDateManager.instance.getIsPlayMusic()&&PlaySound.instance.randomPlaySound(),BackBlock.instance.clickBlockEnterQueue(this,this.indexX,this.indexY,this.direction),this.cleanAndAdd(),0==this.direction){this.greenBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.greenBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.greenBlockArr.length;e++){var t=this.greenBlockArr[e].indexX,i=this.greenBlockArr[e].indexY,s=this.greenBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.greenBlockArr[e],t,i,s),this.greenBlockArr[e].changePosition(t,i+1)}}if(1==this.direction){this.greenBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.greenBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.greenBlockArr.length;e++){var t=this.greenBlockArr[e].indexX,i=this.greenBlockArr[e].indexY,s=this.greenBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.greenBlockArr[e],t,i,s),this.greenBlockArr[e].changePosition(t,i-1)}}if(2==this.direction){this.greenBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.greenBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.greenBlockArr.length;e++){var t=this.greenBlockArr[e].indexX,i=this.greenBlockArr[e].indexY,s=this.greenBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.greenBlockArr[e],t,i,s),t%2==0&&this.greenBlockArr[e].changePosition(t+1,i+1),t%2!=0&&this.greenBlockArr[e].changePosition(t+1,i)}}if(3==this.direction){this.greenBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.greenBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.greenBlockArr.length;e++){var t=this.greenBlockArr[e].indexX,i=this.greenBlockArr[e].indexY,s=this.greenBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.greenBlockArr[e],t,i,s),t%2==0&&this.greenBlockArr[e].changePosition(t+1,i),t%2!=0&&this.greenBlockArr[e].changePosition(t+1,i-1)}}if(4==this.direction){this.greenBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.greenBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.greenBlockArr.length;e++){var t=this.greenBlockArr[e].indexX,i=this.greenBlockArr[e].indexY,s=this.greenBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.greenBlockArr[e],t,i,s),t%2==0&&this.greenBlockArr[e].changePosition(t-1,i+1),t%2!=0&&this.greenBlockArr[e].changePosition(t-1,i)}}if(5==this.direction){this.greenBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.greenBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.greenBlockArr.length;e++){var t=this.greenBlockArr[e].indexX,i=this.greenBlockArr[e].indexY,s=this.greenBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.greenBlockArr[e],t,i,s),t%2==0&&this.greenBlockArr[e].changePosition(t-1,i),t%2!=0&&this.greenBlockArr[e].changePosition(t-1,i-1)}}this.changeIndex(),this.indexX%2==0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+this.offsetY+6*this.indexY},200,egret.Ease.backOut),this.indexX%2!=0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+6*this.indexY},200,egret.Ease.backOut),this.changeDirectionAndInto(),this.changeTriangleDirection(this.direction),this.isInFrame(),MainGame.game&&egret.setTimeout(function(){this.changeSceneSize()},this,100),Message.instance.send(MsgCMD.CHANGE_POSITION_GREEN)}},t.prototype.changeSceneSize=function(){var e=null,t=null;e=new Array,t=new Array;for(var i=0,s=0,n=0,r=0,o=this.scaleCoefficient,h=this.scaleCoefficient,a=this.scaleCoefficient,c=this.scaleCoefficient,l=1,d=1,g=0;g<this.blockMg.BlockArr.length;g++)e.push(this.blockMg.BlockArr[g].indexX),t.push(this.blockMg.BlockArr[g].indexY);if(this.sort(e),this.sort(t),n=e[0],r=t[0],i=e[e.length-1],s=t[t.length-1],s>4||2>r){if(s>4)for(var p=s-4,g=0;p-1>g;g++)h*=this.scaleCoefficient;if(2>r)for(var p=Math.abs(r-2),g=0;p-1>g;g++)c*=this.scaleCoefficient;d=h>c?c:h}if(i>8||2>n){if(i>8)for(var p=i-8,g=0;p-1>g;g++)o*=this.scaleCoefficient;if(2>n)for(var p=Math.abs(n-2),g=0;p-1>g;g++)a*=this.scaleCoefficient;l=o>a?a:o}l>d?(egret.Tween.get(MainGame.game.zoomSprite,{loop:!1}).to({scaleX:d,scaleY:d},100),egret.log("_indexYScale=",d)):(egret.Tween.get(MainGame.game.zoomSprite,{loop:!1}).to({scaleX:l,scaleY:l},100),egret.log("_indexXScale=",l))},t.prototype.sort=function(e){for(var t=0;t<e.length-1;t++)for(var i=0;i<e.length-t-1;i++)e[i]>e[i+1]&&(e[i]=e[i]+e[i+1],e[i+1]=e[i]-e[i+1],e[i]=e[i]-e[i+1])},t.prototype.changeDirectionAndInto=function(){if(this._tempConfig)for(var e=0;e<this._tempConfig.length;e+=4){if(this._tempConfig[e]+1==this.colourType&&this.indexX==this._tempConfig[e+1]&&this.indexY==this._tempConfig[e+2]){egret.setTimeout(function(){this.isInto=!0},this,50);break}this.isInto=!1}if(this._tempConfig)for(var e=0;e<this._tempConfig.length;e+=4)if(5==this._tempConfig[e]&&this.indexX==this._tempConfig[e+1]&&this.indexY==this._tempConfig[e+2]){this.direction=this._tempConfig[e+3];break}},t.prototype.changeTriangleDirection=function(e){this.direction=e,0==this.direction&&(this.triangle.x=-10,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:90},500,egret.Ease.bounceOut)),1==this.direction&&(this.triangle.x=-10,this.triangle.y=-10,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-90},500,egret.Ease.bounceOut)),2==this.direction&&(this.triangle.x=-5,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:30},500,egret.Ease.bounceOut)),3==this.direction&&(this.triangle.x=-5,this.triangle.y=-10,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-30},500,egret.Ease.bounceOut)),4==this.direction&&(this.triangle.x=-15,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:150},500,egret.Ease.bounceOut)),5==this.direction&&(this.triangle.x=-15,this.triangle.y=-12,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-150},500,egret.Ease.bounceOut))},t.prototype.changeIndex=function(){if(0==this.direction&&this.indexY++,1==this.direction&&this.indexY--,2==this.direction){if(this.indexX%2==0)return this.indexX++,void this.indexY++;if(this.indexX%2!=0)return void this.indexX++}if(3==this.direction){if(this.indexX%2==0)return void this.indexX++;if(this.indexX%2!=0)return this.indexX++,void this.indexY--}if(4==this.direction){if(this.indexX%2==0)return this.indexX--,void this.indexY++;if(this.indexX%2!=0)return void this.indexX--}if(5==this.direction){if(this.indexX%2==0)return void this.indexX--;if(this.indexX%2!=0)return this.indexX--,void this.indexY--}},t.prototype.changePosition=function(e,t,i){this.indexX=e,this.indexY=t,this.indexX%2==0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+this.offsetY+6*this.indexY},300,egret.Ease.backOut),this.indexX%2!=0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+6*this.indexY},300,egret.Ease.backOut),this.changeDirectionAndInto(),MainGame.game&&egret.setTimeout(function(){this.changeSceneSize()},this,100),i>=0?this.changeTriangleDirection(i):this.changeTriangleDirection(this.direction),this.isInFrame(),Message.instance.send(MsgCMD.CHANGE_POSITION_YELLOW)},t.prototype.cleanAndAdd=function(){this.cleanBlock(),this.checkBlockAdjoin(this.indexX,this.indexY,this.direction);for(var e=0;e<this.greenBlockArr.length;e++){var t=this.greenBlockArr[e].indexX,i=this.greenBlockArr[e].indexY;this.checkBlockAdjoin(t,i,this.direction)}},t.prototype.update=function(){MainGame.game&&(MainGame.game.zoomSprite.scaleX>=.5&&(this.scaleCoefficient=.8),MainGame.game.zoomSprite.scaleX<.5&&(this.scaleCoefficient=.81),MainGame.game.zoomSprite.scaleX<.4&&(this.scaleCoefficient=.82))},t.prototype.isInFrame=function(){if(this.npcMg)for(var e=0;e<this.npcMg.NpcArr.length;e++){if(null!=this.npcMg.NpcArr[e]&&this.npcMg.NpcArr[e].colourType<6&&this.indexX==this.npcMg.NpcArr[e].indexX&&this.indexY==this.npcMg.NpcArr[e].indexY){this.scaleX=this.scaleY=.8,this.block.x=this.block.y=-2,this.blockShadow.visible=!1;break}this.scaleX=this.scaleY=1,this.block.x=this.block.y=0,this.blockShadow.visible=!0}},t.prototype.cleanBlock=function(){var e=this.greenBlockArr.length;this.greenBlockArr.splice(0,e)},t.prototype.checkBlockAdjoin=function(e,t,i){for(var s=this.blockMg.BlockArr,n=0;n<s.length;n++)0==i&&(s[n].indexX!=e||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.greenBlockArr.push(s[n])),1==i&&(s[n].indexX!=e||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.greenBlockArr.push(s[n])),2==i&&(e%2==0&&(s[n].indexX!=e+1||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.greenBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e+1||s[n].indexY!=t||this.isHasBlock(s[n])||this.greenBlockArr.push(s[n]))),3==i&&(e%2==0&&(s[n].indexX!=e+1||s[n].indexY!=t||this.isHasBlock(s[n])||this.greenBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e+1||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.greenBlockArr.push(s[n]))),4==i&&(e%2==0&&(s[n].indexX!=e-1||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.greenBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e-1||s[n].indexY!=t||this.isHasBlock(s[n])||this.greenBlockArr.push(s[n]))),5==i&&(e%2==0&&(s[n].indexX!=e-1||s[n].indexY!=t||this.isHasBlock(s[n])||this.greenBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e-1||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.greenBlockArr.push(s[n])))},t.prototype.isHasBlock=function(e){for(var t=this.greenBlockArr,i=0;i<t.length;i++)if(e==t[i])return!0;return!1},t.prototype.otherBlockIsRefreshPosition=function(){for(var e=0;e<this.blockMg.BlockArr.length;e++)if(this.blockMg.BlockArr[e]!=this&&1==this.blockMg.BlockArr[e].isRefreshPosition)return!0;return!1},t}(Block);__reflect(Block_4.prototype,"Block_4",["IMessage"]);var Block_5=function(e){function t(t,i,s){var n=e.call(this)||this;return n.blockState=1,n.pinkBlockArr=null,n.blockMg=MainGame.game.BlockMg,n.npcMg=MainGame.game.NpcMg,n.indexX=t,n.indexY=i,n.direction=s,n.colourType=5,n.pinkBlockArr=new Array,n}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this._tempConfig=new Array,this.init(),this.addMessage(MsgCMD.CHANGE_POSITION_RED,this),this.addMessage(MsgCMD.CHANGE_POSITION_BLUE,this),this.addMessage(MsgCMD.CHANGE_POSITION_GREEN,this),this.addMessage(MsgCMD.CHANGE_POSITION_YELLOW,this)},t.prototype.recvMsg=function(e,t){switch(e){case MsgCMD.CHANGE_POSITION_RED:case MsgCMD.CHANGE_POSITION_GREEN:case MsgCMD.CHANGE_POSITION_YELLOW:case MsgCMD.CHANGE_POSITION_BLUE:egret.setTimeout(function(){this.cleanAndAdd()},this,30)}},t.prototype.init=function(){this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.blockShadow=new egret.Bitmap(RES.getRes("shadow_png")),this.addChild(this.blockShadow),this.blockShadow.anchorOffsetX=this.blockShadow.width/2,this.blockShadow.anchorOffsetY=this.blockShadow.height/2,this.blockShadow.width=.75*this.blockShadow.width,this.blockShadow.height=.75*this.blockShadow.height,this.blockShadow.x=-8,this.blockShadow.y=8,this.block=new egret.Bitmap(RES.getRes("pinkNpc_png")),this.addChild(this.block),this.block.anchorOffsetX=this.block.width/2,this.block.anchorOffsetY=this.block.height/2,this.block.width=.8*this.block.width,this.block.height=.8*this.block.height,this.block.pixelHitTest=!0,this.width=this.block.width,this.height=this.block.height,this.triangle=new egret.Bitmap(RES.getRes("triangle_png")),this.triangle.anchorOffsetX=this.triangle.width/2,this.triangle.anchorOffsetY=this.triangle.height/2,this.triangle.x=-10,this.triangle.y=-5,this.changeTriangleDirection(this.direction),this.addChild(this.triangle),this.blockPosition(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.refresh,this),this.addListener(this,egret.Event.ENTER_FRAME,this.update,this);
egret.setTimeout(function(){this.checkBlockAdjoin(this.indexX,this.indexY,this.direction);for(var e=0;e<this.pinkBlockArr.length;e++){var t=this.pinkBlockArr[e].indexX,i=this.pinkBlockArr[e].indexY;this.checkBlockAdjoin(t,i,this.direction)}},this,500);this.isInFrame(),this._tempConfig=this.npcMg.Config,this.changeDirectionAndInto()},t.prototype.blockPosition=function(){this.x=this.indexX*this.block.width-12*this.indexX+this.offsetX,this.indexX%2?this.y=this.indexY*this.block.height+6*this.indexY:this.y=this.indexY*this.block.height+this.offsetY+6*this.indexY},t.prototype.refresh=function(){this.isRefreshPosition=!0,egret.setTimeout(function(){this.otherBlockIsRefreshPosition()||this.refreshPosition(),this.isRefreshPosition=!1},this,40)},t.prototype.refreshPosition=function(){if(!MainGame.game.isGameOver()&&MainGame.game.zoomSprite.scaleX>=.25){if(GameDateManager.instance.getIsPlayMusic()&&PlaySound.instance.randomPlaySound(),BackBlock.instance.clickBlockEnterQueue(this,this.indexX,this.indexY,this.direction),this.cleanAndAdd(),0==this.direction){this.pinkBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.pinkBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.pinkBlockArr.length;e++){var t=this.pinkBlockArr[e].indexX,i=this.pinkBlockArr[e].indexY,s=this.pinkBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.pinkBlockArr[e],t,i,s),this.pinkBlockArr[e].changePosition(t,i+1)}}if(1==this.direction){this.pinkBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.pinkBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.pinkBlockArr.length;e++){var t=this.pinkBlockArr[e].indexX,i=this.pinkBlockArr[e].indexY,s=this.pinkBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.pinkBlockArr[e],t,i,s),this.pinkBlockArr[e].changePosition(t,i-1)}}if(2==this.direction){this.pinkBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.pinkBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.pinkBlockArr.length;e++){var t=this.pinkBlockArr[e].indexX,i=this.pinkBlockArr[e].indexY,s=this.pinkBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.pinkBlockArr[e],t,i,s),t%2==0&&this.pinkBlockArr[e].changePosition(t+1,i+1),t%2!=0&&this.pinkBlockArr[e].changePosition(t+1,i)}}if(3==this.direction){this.pinkBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.pinkBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.pinkBlockArr.length;e++){var t=this.pinkBlockArr[e].indexX,i=this.pinkBlockArr[e].indexY,s=this.pinkBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.pinkBlockArr[e],t,i,s),t%2==0&&this.pinkBlockArr[e].changePosition(t+1,i),t%2!=0&&this.pinkBlockArr[e].changePosition(t+1,i-1)}}if(4==this.direction){this.pinkBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.pinkBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.pinkBlockArr.length;e++){var t=this.pinkBlockArr[e].indexX,i=this.pinkBlockArr[e].indexY,s=this.pinkBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.pinkBlockArr[e],t,i,s),t%2==0&&this.pinkBlockArr[e].changePosition(t-1,i+1),t%2!=0&&this.pinkBlockArr[e].changePosition(t-1,i)}}if(5==this.direction){this.pinkBlockArr.length>0?BackBlock.instance.blockEnterQueneNumArr.push(this.pinkBlockArr.length+1):BackBlock.instance.blockEnterQueneNumArr.push(1);for(var e=0;e<this.pinkBlockArr.length;e++){var t=this.pinkBlockArr[e].indexX,i=this.pinkBlockArr[e].indexY,s=this.pinkBlockArr[e].direction;BackBlock.instance.clickBlockEnterQueue(this.pinkBlockArr[e],t,i,s),t%2==0&&this.pinkBlockArr[e].changePosition(t-1,i),t%2!=0&&this.pinkBlockArr[e].changePosition(t-1,i-1)}}this.changeIndex(),this.indexX%2==0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+this.offsetY+6*this.indexY},200,egret.Ease.backOut),this.indexX%2!=0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+6*this.indexY},200,egret.Ease.backOut),this.changeDirectionAndInto(),this.changeTriangleDirection(this.direction),this.isInFrame(),MainGame.game&&egret.setTimeout(function(){this.changeSceneSize()},this,100),Message.instance.send(MsgCMD.CHANGE_POSITION_YELLOW)}},t.prototype.changeSceneSize=function(){var e=null,t=null;e=new Array,t=new Array;for(var i=0,s=0,n=0,r=0,o=this.scaleCoefficient,h=this.scaleCoefficient,a=this.scaleCoefficient,c=this.scaleCoefficient,l=1,d=1,g=0;g<this.blockMg.BlockArr.length;g++)e.push(this.blockMg.BlockArr[g].indexX),t.push(this.blockMg.BlockArr[g].indexY);if(this.sort(e),this.sort(t),n=e[0],r=t[0],i=e[e.length-1],s=t[t.length-1],s>4||2>r){if(s>4)for(var p=s-4,g=0;p-1>g;g++)h*=this.scaleCoefficient;if(2>r)for(var p=Math.abs(r-2),g=0;p-1>g;g++)c*=this.scaleCoefficient;d=h>c?c:h}if(i>8||2>n){if(i>8)for(var p=i-8,g=0;p-1>g;g++)o*=this.scaleCoefficient;if(2>n)for(var p=Math.abs(n-2),g=0;p-1>g;g++)a*=this.scaleCoefficient;l=o>a?a:o}l>d?(egret.Tween.get(MainGame.game.zoomSprite,{loop:!1}).to({scaleX:d,scaleY:d},100),egret.log("_indexYScale=",d)):(egret.Tween.get(MainGame.game.zoomSprite,{loop:!1}).to({scaleX:l,scaleY:l},100),egret.log("_indexXScale=",l))},t.prototype.sort=function(e){for(var t=0;t<e.length-1;t++)for(var i=0;i<e.length-t-1;i++)e[i]>e[i+1]&&(e[i]=e[i]+e[i+1],e[i+1]=e[i]-e[i+1],e[i]=e[i]-e[i+1])},t.prototype.changeDirectionAndInto=function(){if(this._tempConfig)for(var e=0;e<this._tempConfig.length;e+=4){if(this._tempConfig[e]+1==this.colourType&&this.indexX==this._tempConfig[e+1]&&this.indexY==this._tempConfig[e+2]){egret.setTimeout(function(){this.isInto=!0},this,50);break}this.isInto=!1}if(this._tempConfig)for(var e=0;e<this._tempConfig.length;e+=4)if(5==this._tempConfig[e]&&this.indexX==this._tempConfig[e+1]&&this.indexY==this._tempConfig[e+2]){this.direction=this._tempConfig[e+3];break}},t.prototype.changeTriangleDirection=function(e){this.direction=e,0==this.direction&&(this.triangle.x=-10,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:90},500,egret.Ease.bounceOut)),1==this.direction&&(this.triangle.x=-10,this.triangle.y=-10,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-90},500,egret.Ease.bounceOut)),2==this.direction&&(this.triangle.x=-5,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:30},500,egret.Ease.bounceOut)),3==this.direction&&(this.triangle.x=-5,this.triangle.y=-10,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-30},500,egret.Ease.bounceOut)),4==this.direction&&(this.triangle.x=-15,this.triangle.y=-5,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:150},500,egret.Ease.bounceOut)),5==this.direction&&(this.triangle.x=-15,this.triangle.y=-12,egret.Tween.get(this.triangle,{loop:!1}).to({rotation:-150},500,egret.Ease.bounceOut))},t.prototype.changeIndex=function(){if(0==this.direction&&this.indexY++,1==this.direction&&this.indexY--,2==this.direction){if(this.indexX%2==0)return this.indexX++,void this.indexY++;if(this.indexX%2!=0)return void this.indexX++}if(3==this.direction){if(this.indexX%2==0)return void this.indexX++;if(this.indexX%2!=0)return this.indexX++,void this.indexY--}if(4==this.direction){if(this.indexX%2==0)return this.indexX--,void this.indexY++;if(this.indexX%2!=0)return void this.indexX--}if(5==this.direction){if(this.indexX%2==0)return void this.indexX--;if(this.indexX%2!=0)return this.indexX--,void this.indexY--}},t.prototype.changePosition=function(e,t,i){this.indexX=e,this.indexY=t,this.indexX%2==0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+this.offsetY+6*this.indexY},300,egret.Ease.backOut),this.indexX%2!=0&&egret.Tween.get(this,{loop:!1}).to({x:this.indexX*this.width-12*this.indexX+this.offsetX,y:this.indexY*this.height+6*this.indexY},300,egret.Ease.backOut),this.changeDirectionAndInto(),MainGame.game&&egret.setTimeout(function(){this.changeSceneSize()},this,100),i>=0?this.changeTriangleDirection(i):this.changeTriangleDirection(this.direction),this.isInFrame(),Message.instance.send(MsgCMD.CHANGE_POSITION_YELLOW)},t.prototype.cleanAndAdd=function(){this.cleanBlock(),this.checkBlockAdjoin(this.indexX,this.indexY,this.direction);for(var e=0;e<this.pinkBlockArr.length;e++){var t=this.pinkBlockArr[e].indexX,i=this.pinkBlockArr[e].indexY;this.checkBlockAdjoin(t,i,this.direction)}},t.prototype.update=function(){MainGame.game&&(MainGame.game.zoomSprite.scaleX>=.5&&(this.scaleCoefficient=.8),MainGame.game.zoomSprite.scaleX<.5&&(this.scaleCoefficient=.81),MainGame.game.zoomSprite.scaleX<.4&&(this.scaleCoefficient=.82))},t.prototype.isInFrame=function(){if(this.npcMg)for(var e=0;e<this.npcMg.NpcArr.length;e++){if(null!=this.npcMg.NpcArr[e]&&this.npcMg.NpcArr[e].colourType<6&&this.indexX==this.npcMg.NpcArr[e].indexX&&this.indexY==this.npcMg.NpcArr[e].indexY){this.scaleX=this.scaleY=.8,this.block.x=this.block.y=-2,this.blockShadow.visible=!1;break}this.scaleX=this.scaleY=1,this.block.x=this.block.y=0,this.blockShadow.visible=!0}},t.prototype.cleanBlock=function(){var e=this.pinkBlockArr.length;this.pinkBlockArr.splice(0,e)},t.prototype.checkBlockAdjoin=function(e,t,i){for(var s=this.blockMg.BlockArr,n=0;n<s.length;n++)0==i&&(s[n].indexX!=e||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.pinkBlockArr.push(s[n])),1==i&&(s[n].indexX!=e||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.pinkBlockArr.push(s[n])),2==i&&(e%2==0&&(s[n].indexX!=e+1||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.pinkBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e+1||s[n].indexY!=t||this.isHasBlock(s[n])||this.pinkBlockArr.push(s[n]))),3==i&&(e%2==0&&(s[n].indexX!=e+1||s[n].indexY!=t||this.isHasBlock(s[n])||this.pinkBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e+1||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.pinkBlockArr.push(s[n]))),4==i&&(e%2==0&&(s[n].indexX!=e-1||s[n].indexY!=t+1||this.isHasBlock(s[n])||this.pinkBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e-1||s[n].indexY!=t||this.isHasBlock(s[n])||this.pinkBlockArr.push(s[n]))),5==i&&(e%2==0&&(s[n].indexX!=e-1||s[n].indexY!=t||this.isHasBlock(s[n])||this.pinkBlockArr.push(s[n])),e%2!=0&&(s[n].indexX!=e-1||s[n].indexY!=t-1||this.isHasBlock(s[n])||this.pinkBlockArr.push(s[n])))},t.prototype.isHasBlock=function(e){for(var t=this.pinkBlockArr,i=0;i<t.length;i++)if(e==t[i])return!0;return!1},t.prototype.otherBlockIsRefreshPosition=function(){for(var e=0;e<this.blockMg.BlockArr.length;e++)if(this.blockMg.BlockArr[e]!=this&&1==this.blockMg.BlockArr[e].isRefreshPosition)return!0;return!1},t}(Block);__reflect(Block_5.prototype,"Block_5",["IMessage"]);var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function s(s){t.call(i,s,e)}if(RES.hasRes(e)){var n=RES.getRes(e);n?s(n):RES.getResAsync(e,s,this)}else RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var BlockManager=function(e){function t(t){var i=e.call(this)||this;return i.levelId=1,i.blockArr=new Array,i.config=new Array,i.levelId=t,i}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this.init()},t.prototype.init=function(){switch(this.levelId){case 1:this.config=[0,5,3,0];break;case 2:this.config=[2,5,1,0,1,5,2,0];break;case 3:this.config=[2,4,3,1,1,5,3,0,0,3,4,3];break;case 4:this.config=[0,5,2,0,4,5,4,1,3,6,2,4];break;case 5:this.config=[4,5,2,0,1,4,4,3,2,4,3,2];break;case 6:this.config=[4,5,2,0,0,5,3,0];break;case 7:this.config=[3,3,3,2,4,4,3,0,0,5,5,1];break;case 8:this.config=[2,4,2,3,3,4,3,2,1,6,2,0,0,6,3,1];break;case 9:this.config=[2,4,2,2,4,5,2,0,1,5,4,0,0,6,4,5];break;case 10:this.config=[0,5,3,0,3,5,4,5,4,4,2,2,1,4,3,3,2,6,3,5];break;case 11:this.config=[0,5,2,2,1,5,3,3,2,6,1,4,3,6,3,5,4,6,4,1];break;case 12:this.config=[1,4,2,3,1,4,3,2,3,5,4,3,4,5,5,3,0,6,4,1,2,7,4,5];break;case 13:this.config=[1,2,4,3,3,3,5,3,4,4,4,2,0,5,3,1,2,6,3,5];break;case 14:this.config=[3,3,4,3,4,4,2,0,0,5,3,0,2,6,4,5];break;case 15:this.config=[3,4,1,3,4,5,1,5,0,6,1,1,2,7,2,5];break;case 16:this.config=[0,4,1,0,4,5,3,0,2,6,1,0,3,6,4,5];break;case 17:this.config=[2,5,1,0,4,5,3,3,0,6,3,0,3,6,5,5,2,7,1,4];break;case 18:this.config=[2,5,1,2,3,6,1,0,3,6,4,5,4,7,1,0,2,7,3,4,0,8,2,5];break;case 19:this.config=[2,3,5,2,4,4,1,2,0,4,2,0,3,4,4,0,2,5,1,0,3,6,2,0]}for(var e=0;e<this.config.length;e+=4)this.addBlock(this.config[e],this.config[e+1],this.config[e+2],this.config[e+3])},t.prototype.addBlock=function(e,t,i,s){var n=null;switch(e){case 0:n=new Block_1(t,i,s);break;case 1:n=new Block_2(t,i,s);break;case 2:n=new Block_3(t,i,s);break;case 3:n=new Block_4(t,i,s);break;case 4:n=new Block_5(t,i,s)}this.addChild(n),this.blockArr.push(n)},t.prototype.removeBlock=function(e){var t=this.blockArr.indexOf(e);-1!=t&&(this.removeChild(this.blockArr[t]),this.blockArr[t]=null,this.blockArr.splice(t,1))},Object.defineProperty(t.prototype,"BlockArr",{get:function(){return this.blockArr},enumerable:!0,configurable:!0}),t}(BaseSprite);__reflect(BlockManager.prototype,"BlockManager");var ChangeNpc_1=function(e){function t(t,i,s){var n=e.call(this)||this;return n.indexX=t,n.indexY=i,n.direction=s,n.colourType=6,n}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this.init()},t.prototype.init=function(){this.npcIm=new egret.Bitmap(RES.getRes("changeTriangle_png")),this.addChild(this.npcIm),this.npcIm.anchorOffsetX=this.npcIm.width/2,this.npcIm.anchorOffsetY=this.npcIm.height/2,this.npcIm.scaleX=this.npcIm.scaleY=.8,0==this.direction&&(this.npcIm.x=-10,this.npcIm.y=-5,this.npcIm.rotation=90),1==this.direction&&(this.npcIm.x=-10,this.npcIm.y=-10,this.npcIm.rotation=-90),2==this.direction&&(this.npcIm.x=-5,this.npcIm.y=-5,this.npcIm.rotation=30),3==this.direction&&(this.npcIm.x=-5,this.npcIm.y=-10,this.npcIm.rotation=-30),4==this.direction&&(this.npcIm.x=-15,this.npcIm.y=-5,this.npcIm.rotation=150),5==this.direction&&(this.npcIm.x=-15,this.npcIm.y=-12,this.npcIm.rotation=-150),this.x=78.4*this.indexX-12*this.indexX+this.offsetX,this.indexX%2?this.y=68.8*this.indexY+6*this.indexY:this.y=68.8*this.indexY+this.offsetY+6*this.indexY},t.prototype.update=function(){},t}(NPC);__reflect(ChangeNpc_1.prototype,"ChangeNpc_1");var NPC_1=function(e){function t(t,i,s){var n=e.call(this)||this;return n.indexX=t,n.indexY=i,n.direction=s,n.colourType=1,n}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this.init()},t.prototype.init=function(){this.npcShadow=new egret.Bitmap(RES.getRes("shadowEmpty_png")),this.npcShadow.anchorOffsetX=this.npcShadow.width/2,this.npcShadow.anchorOffsetY=this.npcShadow.height/2,this.addChild(this.npcShadow),this.npcShadow.width=.8*this.npcShadow.width,this.npcShadow.height=.8*this.npcShadow.height,this.npcShadow.x=-6,this.npcShadow.y=7,this.npcIm=new egret.Bitmap(RES.getRes("redEmpty_png")),this.npcIm.anchorOffsetX=this.npcIm.width/2,this.npcIm.anchorOffsetY=this.npcIm.height/2,this.addChild(this.npcIm),this.npcIm.width=.8*this.npcIm.width,this.npcIm.height=.8*this.npcIm.height,this.x=this.indexX*this.npcIm.width-12*this.indexX+this.offsetX,this.indexX%2?this.y=this.indexY*this.npcIm.height+6*this.indexY:this.y=this.indexY*this.npcIm.height+this.offsetY+6*this.indexY,this.cacheAsBitmap=!0},t.prototype.update=function(){},t}(NPC);__reflect(NPC_1.prototype,"NPC_1");var NPC_2=function(e){function t(t,i,s){var n=e.call(this)||this;return n.indexX=t,n.indexY=i,n.direction=s,n.colourType=1,n.colourType=2,n}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this.init()},t.prototype.init=function(){this.npcShadow=new egret.Bitmap(RES.getRes("shadowEmpty_png")),this.npcShadow.anchorOffsetX=this.npcShadow.width/2,this.npcShadow.anchorOffsetY=this.npcShadow.height/2,this.addChild(this.npcShadow),this.npcShadow.width=.8*this.npcShadow.width,this.npcShadow.height=.8*this.npcShadow.height,this.npcShadow.x=-6,this.npcShadow.y=7,this.npcIm=new egret.Bitmap(RES.getRes("blueEmpty_png")),this.npcIm.anchorOffsetX=this.npcIm.width/2,this.npcIm.anchorOffsetY=this.npcIm.height/2,this.addChild(this.npcIm),this.npcIm.width=.8*this.npcIm.width,this.npcIm.height=.8*this.npcIm.height,this.x=this.indexX*this.npcIm.width-12*this.indexX+this.offsetX,this.indexX%2?this.y=this.indexY*this.npcIm.height+6*this.indexY:this.y=this.indexY*this.npcIm.height+this.offsetY+6*this.indexY,this.cacheAsBitmap=!0},t.prototype.update=function(){},t}(NPC);__reflect(NPC_2.prototype,"NPC_2");var NPC_3=function(e){function t(t,i,s){var n=e.call(this)||this;return n.indexX=t,n.indexY=i,n.direction=s,n.colourType=1,n.colourType=3,n}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this.init()},t.prototype.init=function(){this.npcShadow=new egret.Bitmap(RES.getRes("shadowEmpty_png")),this.npcShadow.anchorOffsetX=this.npcShadow.width/2,this.npcShadow.anchorOffsetY=this.npcShadow.height/2,this.addChild(this.npcShadow),this.npcShadow.width=.8*this.npcShadow.width,this.npcShadow.height=.8*this.npcShadow.height,this.npcShadow.x=-6,this.npcShadow.y=7,this.npcIm=new egret.Bitmap(RES.getRes("yellowEmpty_png")),this.npcIm.anchorOffsetX=this.npcIm.width/2,this.npcIm.anchorOffsetY=this.npcIm.height/2,this.addChild(this.npcIm),this.npcIm.width=.8*this.npcIm.width,this.npcIm.height=.8*this.npcIm.height,this.x=this.indexX*this.npcIm.width-12*this.indexX+this.offsetX,this.indexX%2?this.y=this.indexY*this.npcIm.height+6*this.indexY:this.y=this.indexY*this.npcIm.height+this.offsetY+6*this.indexY,this.cacheAsBitmap=!0},t.prototype.update=function(){},t}(NPC);__reflect(NPC_3.prototype,"NPC_3");var NPC_4=function(e){function t(t,i,s){var n=e.call(this)||this;return n.indexX=t,n.indexY=i,n.direction=s,n.colourType=1,n.colourType=4,n}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this.init()},t.prototype.init=function(){this.npcShadow=new egret.Bitmap(RES.getRes("shadowEmpty_png")),this.npcShadow.anchorOffsetX=this.npcShadow.width/2,this.npcShadow.anchorOffsetY=this.npcShadow.height/2,this.addChild(this.npcShadow),this.npcShadow.width=.8*this.npcShadow.width,this.npcShadow.height=.8*this.npcShadow.height,this.npcShadow.x=-6,this.npcShadow.y=7,this.npcIm=new egret.Bitmap(RES.getRes("greenEmpty_png")),this.npcIm.anchorOffsetX=this.npcIm.width/2,this.npcIm.anchorOffsetY=this.npcIm.height/2,this.addChild(this.npcIm),this.npcIm.width=.8*this.npcIm.width,this.npcIm.height=.8*this.npcIm.height,this.x=this.indexX*this.npcIm.width-12*this.indexX+this.offsetX,this.indexX%2?this.y=this.indexY*this.npcIm.height+6*this.indexY:this.y=this.indexY*this.npcIm.height+this.offsetY+6*this.indexY,this.cacheAsBitmap=!0},t.prototype.update=function(){},t}(NPC);__reflect(NPC_4.prototype,"NPC_4");var NPC_5=function(e){function t(t,i,s){var n=e.call(this)||this;return n.indexX=t,n.indexY=i,n.direction=s,n.colourType=1,n.colourType=5,n}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this.init()},t.prototype.init=function(){this.npcShadow=new egret.Bitmap(RES.getRes("shadowEmpty_png")),this.npcShadow.anchorOffsetX=this.npcShadow.width/2,this.npcShadow.anchorOffsetY=this.npcShadow.height/2,this.addChild(this.npcShadow),this.npcShadow.width=.8*this.npcShadow.width,this.npcShadow.height=.8*this.npcShadow.height,this.npcShadow.x=-6,this.npcShadow.y=7,this.npcIm=new egret.Bitmap(RES.getRes("pinkEmpty_png")),this.npcIm.anchorOffsetX=this.npcIm.width/2,this.npcIm.anchorOffsetY=this.npcIm.height/2,this.addChild(this.npcIm),this.npcIm.width=.8*this.npcIm.width,this.npcIm.height=.8*this.npcIm.height,this.x=this.indexX*this.npcIm.width-12*this.indexX+this.offsetX,this.indexX%2?this.y=this.indexY*this.npcIm.height+6*this.indexY:this.y=this.indexY*this.npcIm.height+this.offsetY+6*this.indexY,this.cacheAsBitmap=!0},t.prototype.update=function(){},t}(NPC);__reflect(NPC_5.prototype,"NPC_5");var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=i.sent(),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return t=i.sent(),console.log(t),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),e=new LoadingUI,[4,RES.loadGroup("loading")];case 2:return i.sent(),this.stage.addChild(e),[4,this.loadTheme()];case 3:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 4:return i.sent(),this.stage.removeChild(e),[3,6];case 5:return t=i.sent(),console.error(t),[3,6];case 6:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var s=new eui.Theme("resource/default.thm.json",e.stage);s.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){this.addChild(new MainModule)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t}(eui.UILayer);__reflect(Main.prototype,"Main");var NpcManager=function(e){function t(t){var i=e.call(this)||this;return i.levelId=0,i.npcArr=new Array,i.config=new Array,i.levelId=t,i}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this.init()},t.prototype.init=function(){switch(this.levelId){case 1:this.config=[0,5,4,-1];break;case 2:this.config=[2,5,3,-1,1,5,4,-1];break;case 3:this.config=[2,5,2,-1,1,5,4,-1,0,6,2,-1];break;case 4:this.config=[3,5,2,-1,0,5,3,-1,4,5,4,-1];break;case 5:this.config=[1,5,4,-1,2,6,3,-1,4,6,4,-1];break;case 6:this.config=[5,5,4,3,4,6,3,-1,0,7,3,-1];break;case 7:this.config=[3,6,3,-1,4,6,2,-1,0,7,4,-1,5,5,4,3];break;case 8:this.config=[5,5,2,2,5,5,4,3,0,6,2,-1,3,6,3,-1,2,7,2,-1,1,7,3,-1];break;case 9:this.config=[0,4,5,-1,1,5,5,-1,4,6,4,-1,2,7,4,-1];break;case 10:this.config=[2,4,2,-1,3,4,3,-1,1,5,2,-1,0,5,4,-1,4,6,2,-1];break;case 11:this.config=[3,3,3,-1,2,4,2,-1,1,6,2,-1,4,7,2,-1,0,7,3,-1];break;case 12:this.config=[1,5,2,-1,2,5,3,-1,3,6,2,-1,0,7,3,-1,4,7,4,-1,1,8,3,-1];break;case 13:this.config=[5,5,2,0,5,5,4,3,0,5,4,-1,1,6,2,-1,4,6,3,-1,3,6,4,-1,5,6,4,1,2,7,3,-1];break;case 14:this.config=[3,3,4,-1,4,4,3,-1,5,4,3,3,2,5,4,-1,5,5,5,1,0,6,4,-1,5,6,2,4];break;case 15:this.config=[5,4,2,0,5,4,3,2,2,5,3,-1,5,5,4,1,5,6,0,0,3,6,3,-1,4,6,4,-1,0,7,5,-1];break;case 16:this.config=[5,4,2,0,5,4,3,3,4,4,3,-1,5,5,2,4,0,5,3,-1,3,6,2,-1,5,6,2,5,5,6,3,1,2,7,2,-1];break;case 17:this.config=[5,4,2,0,2,4,2,-1,2,4,3,-1,3,5,2,-1,5,5,2,4,5,5,3,3,4,5,3,-1,0,6,3,-1,5,6,4,5];break;case 18:this.config=[3,4,2,-1,5,4,2,3,2,4,3,-1,5,4,4,1,3,5,2,-1,5,5,3,2,0,5,3,-1,2,6,2,0,4,6,3,-1,5,6,3,1,5,7,2,4];break;case 19:this.config=[5,4,3,2,5,4,5,2,2,6,2,-1,3,6,3,-1,0,6,4,-1,2,6,5,-1,5,6,4,1,5,6,5,5,5,6,6,1,4,7,3,-1,3,7,5,-1]}for(var e=0;e<this.config.length;e+=4)this.addNpc(this.config[e],this.config[e+1],this.config[e+2],this.config[e+3]);this.cacheAsBitmap=!0},t.prototype.addNpc=function(e,t,i,s){var n=null;switch(e){case 0:n=new NPC_1(t,i,s);break;case 1:n=new NPC_2(t,i,s);break;case 2:n=new NPC_3(t,i,s);break;case 3:n=new NPC_4(t,i,s);break;case 4:n=new NPC_5(t,i,s);break;case 5:n=new ChangeNpc_1(t,i,s)}this.addChild(n),this.npcArr.push(n)},t.prototype.removeNpc=function(e){var t=this.npcArr.indexOf(e);-1!=t&&(this.removeChild(this.npcArr[t]),this.npcArr[t]=null,this.npcArr.splice(t,1))},Object.defineProperty(t.prototype,"NpcArr",{get:function(){return this.npcArr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Config",{get:function(){return this.config},enumerable:!0,configurable:!0}),t}(BaseSprite);__reflect(NpcManager.prototype,"NpcManager");var Help=function(e){function t(){var t=e.call(this)||this;return t.skinName="HelpSceneSkin",t}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this.addListener(this.exml_backMenuBtn,egret.TouchEvent.TOUCH_TAP,this.backMenuHandler,this)},t.prototype.createChildren=function(){e.prototype.createChildren.call(this)},t.prototype.backMenuHandler=function(){var e=this;GameDateManager.instance.getIsPlayMusic()&&SoundManager.getInstance().playEffect("soundClick_mp3"),egret.Tween.get(this.exml_backMenuBtn,{loop:!1}).to({scaleX:.9,scaleY:.9},50,egret.Ease.backOut).to({scaleX:1,scaleY:1},50,egret.Ease.backOut).call(function(){egret.Tween.removeTweens(e),PanelController.instance.removeChild(e)})},t}(BaseModule);__reflect(Help.prototype,"Help");var MainMenu=function(e){function t(){var t=e.call(this)||this;return t.circleMask=null,t.starIsClick=!1,t.skinName="MainMenuSceneSkin",t}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this.addListener(this.exml_startBtn,egret.TouchEvent.TOUCH_TAP,this.startHandler,this),this.addListener(this.exml_soundBtn,egret.TouchEvent.TOUCH_TAP,this.soundHandler,this),this.addListener(this.exml_helpBtn,egret.TouchEvent.TOUCH_TAP,this.helpHandler,this)},t.prototype.createChildren=function(){var t=this;e.prototype.createChildren.call(this),GameDateManager.instance.getIsPlayMusic()?this.exml_soundBtn.iconDisplay.source="kai_png":this.exml_soundBtn.iconDisplay.source="guan_png",this.circleMaskHandler(),egret.Tween.get(this.circleMask,{loop:!1}).to({scaleX:0,scaleY:0}).wait(100).to({scaleX:41,scaleY:41},500).wait(500).call(function(){t.startTw=egret.Tween.get(t.exml_startBtn,{loop:!0}).to({scaleX:.85,scaleY:.85},1e3,egret.Ease.backOut).to({scaleX:1,scaleY:1},500,egret.Ease.backOut).wait(1500)}),egret.localStorage.clear();for(var i=1;20>i;i++)null==egret.localStorage.getItem("level"+i)&&egret.localStorage.setItem("level"+i,"0");null==egret.localStorage.getItem("playerScore")&&egret.localStorage.setItem("playerScore","0"),null==egret.localStorage.getItem("overSceneIsFirstRun")&&egret.localStorage.setItem("overSceneIsFirstRun","true"),null==egret.localStorage.getItem("level2IsFirstRun")&&egret.localStorage.setItem("level2IsFirstRun","true"),null==egret.localStorage.getItem("level6IsFirstRun")&&egret.localStorage.setItem("level6IsFirstRun","true");for(var i=1;20>i;i++)null==egret.localStorage.getItem("level"+i+"score")&&egret.localStorage.setItem("level"+i+"score","0")},t.prototype.circleMaskHandler=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight;this.circleMask=new egret.Shape,this.circleMask.anchorOffsetX=this.circleMask.width/2,this.circleMask.anchorOffsetY=this.circleMask.height/2,this.circleMask.x=e/2,this.circleMask.y=t/2,this.circleMask.graphics.beginFill(65535),this.circleMask.graphics.drawCircle(0,0,10),this.circleMask.graphics.endFill(),this.addChild(this.circleMask),this.exml_menuGroup.mask=this.circleMask},t.prototype.startHandler=function(e){var t=this;this.starIsClick||(this.starIsClick=!this.starIsClick,null!=this.startTw&&this.startTw.setPaused(!0),GameDateManager.instance.getIsPlayMusic()&&SoundManager.getInstance().playEffect("soundClick_mp3"),egret.Tween.get(this.exml_startBtn,{loop:!1}).wait(100).to({scaleX:.65,scaleY:.65},150,egret.Ease.backOut).call(function(){egret.Tween.get(t.circleMask,{loop:!1}).to({scaleX:0,scaleY:0},500).wait(150).call(function(){egret.Tween.removeTweens(t),Message.instance.send(MsgCMD.SHOW_LEVEL_SCENE)})}))},t.prototype.helpHandler=function(){GameDateManager.instance.getIsPlayMusic()&&SoundManager.getInstance().playEffect("soundClick_mp3"),egret.Tween.get(this.exml_helpBtn,{loop:!1}).to({scaleX:.9,scaleY:.9},50,egret.Ease.backOut).to({scaleX:1,scaleY:1},50,egret.Ease.backOut).call(function(){PanelController.instance.add(new Help)})},t.prototype.soundHandler=function(){egret.Tween.get(this.exml_soundBtn,{loop:!1}).to({scaleX:.9,scaleY:.9},50,egret.Ease.backOut).to({scaleX:1,scaleY:1},50,egret.Ease.backOut);var e=GameDateManager.instance.getIsPlayMusic();GameDateManager.instance.setIsPlayMusic(!e),0==!e&&(this.exml_soundBtn.iconDisplay.source="guan_png"),1==!e&&(this.exml_soundBtn.iconDisplay.source="kai_png"),e||SoundManager.getInstance().playEffect("soundClick_mp3")},t}(BaseModule);__reflect(MainMenu.prototype,"MainMenu");var LevelRenderer=function(e){function t(){var t=e.call(this)||this;return t.isCheck=!1,t.isClick=!1,t.skinName="RendererSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.model=this.data,this.exml_levelBtn.iconDisplay.source=this.model.name+"_png",this.id=this.model.id;var t=""+this.id;("1"==egret.localStorage.getItem("level"+t)||1==this.id)&&(this.exml_levelShadowIm.visible=!1,this.exml_levelBtn.touchEnabled=!0)},t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this.addListener(this.exml_levelBtn,egret.TouchEvent.TOUCH_TAP,this.levelHandler,this)},t.prototype.levelHandler=function(){var e=this;if(!this.isClick&&(this.isClick=!this.isClick,"1"==egret.localStorage.getItem("level"+this.id)||1==this.id)){GameDateManager.instance.getIsPlayMusic()&&SoundManager.getInstance().playEffect("soundClick_mp3");egret.Tween.get(this.exml_levelBtn,{loop:!1}).to({scaleX:.7,scaleY:.7},200,egret.Ease.backOut).wait(100).call(function(){egret.Tween.removeTweens(e),Message.instance.send(MsgCMD.SHOW_MAIN_GAME,e.id)})}},t}(BaseItemrenerer);__reflect(LevelRenderer.prototype,"LevelRenderer");var LevelsScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="LevelSceneSkin",t}return __extends(t,e),t.prototype.add_view_handler=function(t){e.prototype.add_view_handler.call(this,t),this.addListener(this.exml_backMenuBtn,egret.TouchEvent.TOUCH_TAP,this.backMenuHandler,this),this.addListener(this.exml_soundBtn,egret.TouchEvent.TOUCH_TAP,this.soundHandler,this)},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),GameDateManager.instance.getIsPlayMusic()?this.exml_soundBtn.iconDisplay.source="kai_png":this.exml_soundBtn.iconDisplay.source="guan_png",LevelConfig.getInstnace().init("levelConfig_txt",LevelConfigModel,[],0),this.exml_list1.itemRenderer=LevelRenderer,this.exml_list1.dataProvider=new eui.ArrayCollection(LevelConfig.getInstnace().getLevel1Arr());var t=new eui.HorizontalLayout;t.gap=10,t.paddingTop=0,t.horizontalAlign=egret.HorizontalAlign.CENTER,this.exml_list1.layout=t,LevelConfig.getInstnace().init("levelConfig_txt",LevelConfigModel,[],1),this.exml_list2.itemRenderer=LevelRenderer,this.exml_list2.dataProvider=new eui.ArrayCollection(LevelConfig.getInstnace().getLevel2Arr());var i=new eui.HorizontalLayout;i.gap=10,i.paddingTop=0,i.horizontalAlign=egret.HorizontalAlign.CENTER,this.exml_list2.layout=i,LevelConfig.getInstnace().init("levelConfig_txt",LevelConfigModel,[],2),this.exml_list3.itemRenderer=LevelRenderer,this.exml_list3.dataProvider=new eui.ArrayCollection(LevelConfig.getInstnace().getLevel3Arr());var s=new eui.HorizontalLayout;s.gap=10,s.paddingTop=0,s.horizontalAlign=egret.HorizontalAlign.CENTER,this.exml_list3.layout=s,LevelConfig.getInstnace().init("levelConfig_txt",LevelConfigModel,[],3),this.exml_list4.itemRenderer=LevelRenderer,this.exml_list4.dataProvider=new eui.ArrayCollection(LevelConfig.getInstnace().getLevel4Arr());
var n=new eui.HorizontalLayout;n.gap=10,n.paddingTop=0,n.horizontalAlign=egret.HorizontalAlign.CENTER,this.exml_list4.layout=n,LevelConfig.getInstnace().init("levelConfig_txt",LevelConfigModel,[],4),this.exml_list5.itemRenderer=LevelRenderer,this.exml_list5.dataProvider=new eui.ArrayCollection(LevelConfig.getInstnace().getLevel5Arr());var r=new eui.HorizontalLayout;if(r.gap=10,r.paddingTop=0,r.horizontalAlign=egret.HorizontalAlign.CENTER,this.exml_list5.layout=r,"0"==egret.localStorage.getItem("level1")){var o=new ReverseMask;this.addChild(o),o.createGuide(1)}},t.prototype.backMenuHandler=function(e){GameDateManager.instance.getIsPlayMusic()&&SoundManager.getInstance().playEffect("soundClick_mp3"),Message.instance.send(MsgCMD.SHOW_MAIN_MENU)},t.prototype.soundHandler=function(){egret.Tween.get(this.exml_soundBtn,{loop:!1}).to({scaleX:.9,scaleY:.9},50,egret.Ease.backOut).to({scaleX:1,scaleY:1},50,egret.Ease.backOut);var e=GameDateManager.instance.getIsPlayMusic();GameDateManager.instance.setIsPlayMusic(!e),0==!e&&(this.exml_soundBtn.iconDisplay.source="guan_png"),1==!e&&(this.exml_soundBtn.iconDisplay.source="kai_png"),e||SoundManager.getInstance().playEffect("soundClick_mp3")},t}(BaseModule);__reflect(LevelsScene.prototype,"LevelsScene");